"use strict";(self["webpackChunk"]=self["webpackChunk"]||[]).push([[7715],{55362:(t,e,a)=>{a.r(e),a.d(e,{default:()=>R});var s=a(20641),i=a(53751),d=a(90033);const l={class:"main-content"},r={key:0,class:"loading_page spinner spinner-primary mr-3"},o={id:"autocomplete",class:"autocomplete"},u=["placeholder"],n={class:"autocomplete-result-list"},c=["onMousedown"],h={class:"table-responsive"},p={class:"table table-hover"},m={class:"bg-gray-300"},_=(0,s.Lk)("th",{scope:"col"},"#",-1),b={scope:"col"},k={scope:"col"},g={scope:"col"},f={scope:"col"},v={scope:"col"},y=(0,s.Lk)("th",{scope:"col",class:"text-center"},[(0,s.Lk)("i",{class:"fa fa-trash"})],-1),$={key:0},L={colspan:"7"},w={class:"badge badge-outline-warning"},F={class:"quantity"},C=["onClick"],S=["onKeyup","max","onUpdate:modelValue","disabled"],j=["onClick"],q=["onUpdate:modelValue","onChange"],P={value:"add"},V={value:"sub"},W=["onClick"],T=(0,s.Lk)("i",{class:"i-Close-Window text-25 text-danger"},null,-1),A=[T],E=["placeholder"],x=(0,s.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),U={key:0,class:"typo__p"},N=(0,s.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),Q=[N];function X(t,e,a,T,N,X){const G=(0,s.g2)("breadcumb"),B=(0,s.g2)("v-select"),I=(0,s.g2)("b-form-invalid-feedback"),D=(0,s.g2)("b-form-group"),K=(0,s.g2)("validation-provider"),R=(0,s.g2)("b-col"),J=(0,s.g2)("b-form-input"),M=(0,s.g2)("b-input-group-prepend"),O=(0,s.g2)("b-input-group-append"),Y=(0,s.g2)("b-input-group"),z=(0,s.g2)("b-button"),H=(0,s.g2)("b-row"),Z=(0,s.g2)("b-card"),tt=(0,s.g2)("b-form"),et=(0,s.g2)("validation-observer");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)(G,{page:t.$t("EditAdjustement"),folder:t.$t("ListAdjustments")},null,8,["page","folder"]),N.isLoading?((0,s.uX)(),(0,s.CE)("div",r)):(0,s.Q3)("",!0),N.isLoading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(et,{key:1,ref:"Edit_adjustment"},{default:(0,s.k6)((()=>[(0,s.bF)(tt,{onSubmit:(0,i.D$)(X.Submit_Adjustment,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(H,null,{default:(0,s.k6)((()=>[(0,s.bF)(R,{lg:"12",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Z,null,{default:(0,s.k6)((()=>[(0,s.bF)(H,null,{default:(0,s.k6)((()=>[(0,s.bF)(R,{md:"6",class:"mb-3"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{name:"warehouse",rules:{required:!0}},{default:(0,s.k6)((()=>[(0,s.bF)(D,{"slot-scope":"{ valid, errors }",label:t.$t("warehouse")+" *"},{default:(0,s.k6)((()=>[(0,s.bF)(B,{class:(0,d.C4)({"is-invalid":!!t.errors.length}),state:!t.errors[0]&&(!!t.valid||null),disabled:N.details.length>0,onInput:X.Selected_Warehouse,modelValue:N.adjustment.warehouse_id,"onUpdate:modelValue":e[0]||(e[0]=t=>N.adjustment.warehouse_id=t),reduce:t=>t.value,placeholder:t.$t("Choose_Warehouse"),options:N.warehouses.map((t=>({label:t.name,value:t.id})))},null,8,["class","state","disabled","onInput","modelValue","reduce","placeholder","options"]),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(t.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,s.bF)(R,{lg:"6",md:"6",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{name:"date",rules:{required:!0}},{default:(0,s.k6)((a=>[(0,s.bF)(D,{label:t.$t("date")+" *"},{default:(0,s.k6)((()=>[(0,s.bF)(J,{state:X.getValidationState(a),"aria-describedby":"date-feedback",type:"date",modelValue:N.adjustment.date,"onUpdate:modelValue":e[1]||(e[1]=t=>N.adjustment.date=t)},null,8,["state","modelValue"]),(0,s.bF)(I,{id:"OrderTax-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(R,{md:"12",class:"mb-5"},{default:(0,s.k6)((()=>[(0,s.Lk)("h6",null,(0,d.v_)(t.$t("ProductName")),1),(0,s.Lk)("div",o,[(0,s.Lk)("input",{placeholder:t.$t("Scan_Search_Product_by_Code_Name"),onInput:e[2]||(e[2]=t=>N.search_input=t.target.value),onKeyup:e[3]||(e[3]=t=>X.search(N.search_input)),onFocus:e[4]||(e[4]=(...t)=>X.handleFocus&&X.handleFocus(...t)),onBlur:e[5]||(e[5]=(...t)=>X.handleBlur&&X.handleBlur(...t)),ref:"product_autocomplete",class:"autocomplete-input"},null,40,u),(0,s.bo)((0,s.Lk)("ul",n,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(N.product_filter,(t=>((0,s.uX)(),(0,s.CE)("li",{class:"autocomplete-result",onMousedown:e=>X.SearchProduct(t)},(0,d.v_)(X.getResultValue(t)),41,c)))),256))],512),[[i.aG,N.focused]])])])),_:1}),(0,s.bF)(R,{md:"12"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",h,[(0,s.Lk)("table",p,[(0,s.Lk)("thead",m,[(0,s.Lk)("tr",null,[_,(0,s.Lk)("th",b,(0,d.v_)(t.$t("CodeProduct")),1),(0,s.Lk)("th",k,(0,d.v_)(t.$t("ProductName")),1),(0,s.Lk)("th",g,(0,d.v_)(t.$t("CurrentStock")),1),(0,s.Lk)("th",f,(0,d.v_)(t.$t("Qty")),1),(0,s.Lk)("th",v,(0,d.v_)(t.$t("type")),1),y])]),(0,s.Lk)("tbody",null,[N.details.length<=0?((0,s.uX)(),(0,s.CE)("tr",$,[(0,s.Lk)("td",L,(0,d.v_)(t.$t("NodataAvailable")),1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(N.details,(e=>((0,s.uX)(),(0,s.CE)("tr",{class:(0,d.C4)({row_deleted:1===e.del}),key:e.detail_id},[(0,s.Lk)("td",null,(0,d.v_)(e.detail_id),1),(0,s.Lk)("td",null,(0,d.v_)(e.code),1),(0,s.Lk)("td",null,"("+(0,d.v_)(e.name)+")",1),(0,s.Lk)("td",null,[(0,s.Lk)("span",w,(0,d.v_)(e.current)+" "+(0,d.v_)(e.unit),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",F,[(0,s.bF)(Y,null,{default:(0,s.k6)((()=>[(0,s.bF)(M,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",{class:"btn btn-primary btn-sm",onClick:t=>X.decrement(e,e.detail_id)},"-",8,C)])),_:2},1024),(0,s.bo)((0,s.Lk)("input",{class:"form-control",onKeyup:t=>X.Verified_Qty(e,e.detail_id),min:0,max:e.current,"onUpdate:modelValue":t=>e.quantity=t,disabled:1===e.del},null,40,S),[[i.Jo,e.quantity,void 0,{number:!0}]]),(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",{class:"btn btn-primary btn-sm",onClick:t=>X.increment(e,e.detail_id)},"+",8,j)])),_:2},1024)])),_:2},1024)])]),(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.type=t,onChange:t=>X.Verified_Qty(e,e.detail_id),type:"text",required:"",class:"form-control"},[(0,s.Lk)("option",P,(0,d.v_)(t.$t("Addition")),1),(0,s.Lk)("option",V,(0,d.v_)(t.$t("Subtraction")),1)],40,q),[[i.u1,e.type]])]),(0,s.Lk)("td",null,[(0,s.Lk)("a",{onClick:t=>X.Remove_Product(e.detail_id),class:"btn btn-icon btn-sm",title:"Delete"},A,8,W)])],2)))),128))])])])])),_:1}),(0,s.bF)(R,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(D,{label:t.$t("Note"),class:"mt-4"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>N.adjustment.notes=t),rows:"4",class:"form-control",placeholder:t.$t("Afewwords")},null,8,E),[[i.Jo,N.adjustment.notes]])])),_:1},8,["label"])])),_:1}),(0,s.bF)(R,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(z,{variant:"primary",disabled:N.SubmitProcessing,onClick:X.Submit_Adjustment},{default:(0,s.k6)((()=>[x,(0,s.eW)(" "+(0,d.v_)(t.$t("submit")),1)])),_:1},8,["disabled","onClick"]),e[7]||((0,s.Vq)(-1),e[7]=N.SubmitProcessing?((0,s.uX)(),(0,s.CE)("div",U,Q)):(0,s.Q3)("",!0),(0,s.Vq)(1),e[7])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},512))])}var G=a(5947),B=a.n(G);const I={metaInfo:{title:"Edit Adjustment"},data(){return{focused:!1,timer:null,search_input:"",product_filter:[],isLoading:!0,SubmitProcessing:!1,warehouses:[],products:[],details:[],adjustment:{id:"",notes:"",warehouse_id:"",date:""},product:{id:"",code:"",current:"",quantity:1,name:"",product_id:"",detail_id:"",product_variant_id:"",del:"",unit:""}}},methods:{handleFocus(){this.focused=!0},handleBlur(){this.focused=!1},search(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this.search_input.length<2)return this.product_filter=[];""!=this.adjustment.warehouse_id&&null!=this.adjustment.warehouse_id?this.timer=setTimeout((()=>{const t=this.products.filter((t=>t.code===this.search_input||t.barcode.includes(this.search_input)));1===t.length?this.SearchProduct(t[0]):this.product_filter=this.products.filter((t=>t.name.toLowerCase().includes(this.search_input.toLowerCase())||t.code.toLowerCase().includes(this.search_input.toLowerCase())||t.barcode.toLowerCase().includes(this.search_input.toLowerCase())))}),800):this.makeToast("warning",this.$t("SelectWarehouse"),this.$t("Warning"))},getResultValue(t){return t.code+" ("+t.name+")"},SearchProduct(t){this.product={},this.details.length>0&&this.details.some((e=>e.code===t.code))?this.makeToast("warning",this.$t("AlreadyAdd"),this.$t("Warning")):(this.product.code=t.code,this.product.current=t.qte,t.qte<1?this.product.quantity=t.qte:this.product.quantity=1,this.product.product_variant_id=t.product_variant_id,this.Get_Product_Details(t.id,t.product_variant_id)),this.search_input="",this.$refs.product_autocomplete.value="",this.product_filter=[]},Submit_Adjustment(){this.$refs.Edit_adjustment.validate().then((t=>{t?this.Update_Adjustment():this.makeToast("danger",this.$t("Please_fill_the_form_correctly"),this.$t("Failed"))}))},getValidationState({dirty:t,validated:e,valid:a=null}){return t||e?a:null},makeToast(t,e,a){this.$root.$bvToast.toast(e,{title:a,variant:t,solid:!0})},Get_Products_By_Warehouse(t){B().start(),B().set(.1),axios.get("get_Products_by_warehouse/"+t+"?stock=0&product_service=0").then((t=>{this.products=t.data,B().done()})).catch((t=>{}))},add_product(){this.details.length>0?this.detail_order_id():0===this.details.length&&(this.product.detail_id=1),this.details.push(this.product)},Verified_Qty(t,e){for(var a=0;a<this.details.length;a++)this.details[a].detail_id===e&&(isNaN(t.quantity)&&(this.details[a].quantity=t.current),"sub"==t.type&&t.quantity>t.current?(this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")),this.details[a].quantity=t.current):this.details[a].quantity=t.quantity);this.$forceUpdate()},increment(t,e){for(var a=0;a<this.details.length;a++)this.details[a].detail_id==e&&("sub"==t.type&&t.quantity+1>t.current?this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")):this.formatNumber(this.details[a].quantity++,2));this.$forceUpdate()},decrement(t,e){for(var a=0;a<this.details.length;a++)this.details[a].detail_id==e&&t.quantity-1>0&&("sub"==t.type&&t.quantity-1>t.current?this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")):this.formatNumber(this.details[a].quantity--,2));this.$forceUpdate()},formatNumber(t,e){const a=("string"===typeof t?t:t.toString()).split(".");if(e<=0)return a[0];let s=a[1]||"";if(s.length>e)return`${a[0]}.${s.substr(0,e)}`;while(s.length<e)s+="0";return`${a[0]}.${s}`},Remove_Product(t){for(var e=0;e<this.details.length;e++)t===this.details[e].detail_id&&this.details.splice(e,1)},verifiedForm(){if(this.details.length<=0)return this.makeToast("warning",this.$t("AddProductToList"),this.$t("Warning")),!1;for(var t=0,e=0;e<this.details.length;e++)""!=this.details[e].quantity&&0!==this.details[e].quantity||(t+=1);return!(t>0)||(this.makeToast("warning",this.$t("AddQuantity"),this.$t("Warning")),!1)},Update_Adjustment(){if(this.verifiedForm()){this.SubmitProcessing=!0,B().start(),B().set(.1);let t=this.$route.params.id;axios.put(`adjustments/${t}`,{warehouse_id:this.adjustment.warehouse_id,date:this.adjustment.date,notes:this.adjustment.notes,details:this.details}).then((t=>{B().done(),this.SubmitProcessing=!1,this.$router.push({name:"index_adjustment"}),this.makeToast("success",this.$t("Successfully_Updated"),this.$t("Success"))})).catch((t=>{B().done(),this.makeToast("danger",this.$t("InvalidData"),this.$t("Failed")),this.SubmitProcessing=!1}))}},detail_order_id(){this.product.detail_id=0;var t=this.details.length;this.product.detail_id=this.details[t-1].detail_id+1},Selected_Warehouse(t){this.search_input="",this.product_filter=[],this.Get_Products_By_Warehouse(t)},Get_Product_Details(t,e){axios.get("/show_product_data/"+t+"/"+e).then((t=>{this.product.del=0,this.product.id=0,this.product.product_id=t.data.id,this.product.name=t.data.name,this.product.type="add",this.product.unit=t.data.unit,this.add_product()}))},GetElements(){let t=this.$route.params.id;axios.get(`adjustments/${t}/edit`).then((t=>{this.adjustment=t.data.adjustment,this.details=t.data.details,this.warehouses=t.data.warehouses,this.Get_Products_By_Warehouse(this.adjustment.warehouse_id),this.isLoading=!1})).catch((t=>{setTimeout((()=>{this.isLoading=!1}),500)}))}},created(){this.GetElements()}};var D=a(66262);const K=(0,D.A)(I,[["render",X]]),R=K}}]);
//# sourceMappingURL=edit_adjustment.83e99028.js.map