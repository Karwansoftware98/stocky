"use strict";(self["webpackChunk"]=self["webpackChunk"]||[]).push([[9834],{67452:(e,t,a)=>{a.r(t),a.d(t,{default:()=>fe});var l=a(20641),s=a(90033),n=a(53751);const i={class:"main-content"},r={key:0,class:"loading_page spinner spinner-primary mr-3"},o={key:1},d={slot:"selected-row-actions"},u={slot:"table-actions",class:"mt-2 mb-3"},c=(0,l.Lk)("i",{class:"i-Filter-2"},null,-1),m=(0,l.Lk)("i",{class:"i-File-Copy"},null,-1),h=(0,l.Lk)("i",{class:"i-File-Excel"},null,-1),_={slot:"table-row","slot-scope":"props"},p={key:0},b=(0,l.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),f=(0,l.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),g=(0,l.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),v=(0,l.Lk)("i",{class:"nav-icon i-Eye font-weight-bold mr-2"},null,-1),k=(0,l.Lk)("i",{class:"nav-icon i-Pen-2 font-weight-bold mr-2"},null,-1),y=(0,l.Lk)("i",{class:"nav-icon i-Money-Bag font-weight-bold mr-2"},null,-1),F=(0,l.Lk)("i",{class:"nav-icon i-Add font-weight-bold mr-2"},null,-1),$=(0,l.Lk)("i",{class:"nav-icon i-File-TXT font-weight-bold mr-2"},null,-1),w=(0,l.Lk)("i",{class:"nav-icon i-Close-Window font-weight-bold mr-2"},null,-1),P={key:1},C={key:0,class:"badge badge-outline-success"},R={key:1,class:"badge badge-outline-info"},T={key:2},x={key:0,class:"badge badge-outline-success"},S={key:1,class:"badge badge-outline-primary"},L={key:2,class:"badge badge-outline-warning"},D={key:3},E={class:"ul-btn__text ml-1"},V={key:4},U={class:"ul-btn__text ml-1"},A={class:"px-3 py-2"},W=(0,l.Lk)("i",{class:"i-Filter-2"},null,-1),B=(0,l.Lk)("i",{class:"i-Power-2"},null,-1),X={class:"table-responsive"},O={class:"table table-hover table-bordered table-md"},G={scope:"col"},M={scope:"col"},N={scope:"col"},K={scope:"col"},I={scope:"col"},Q={key:0},q={colspan:"5"},z={role:"group","aria-label":"Basic example",class:"btn-group"},j=["onClick"],Y=(0,l.Lk)("i",{class:"i-Billing"},null,-1),H=[Y],J=["onClick"],Z=(0,l.Lk)("i",{class:"i-Pen-2"},null,-1),ee=[Z],te=["onClick"],ae=(0,l.Lk)("i",{class:"i-Close"},null,-1),le=[ae],se={class:"change_amount"},ne=(0,l.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),ie={key:0,class:"typo__p"},re=(0,l.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),oe=[re];function de(e,t,a,Y,Z,ae){const re=(0,l.g2)("breadcumb"),de=(0,l.g2)("b-button"),ue=(0,l.g2)("vue-excel-xlsx"),ce=(0,l.g2)("b-dropdown-item"),me=(0,l.g2)("b-navbar-nav"),he=(0,l.g2)("b-dropdown"),_e=(0,l.g2)("router-link"),pe=(0,l.g2)("vue-good-table"),be=(0,l.g2)("b-form-input"),fe=(0,l.g2)("b-form-group"),ge=(0,l.g2)("b-col"),ve=(0,l.g2)("v-select"),ke=(0,l.g2)("b-row"),ye=(0,l.g2)("b-sidebar"),Fe=(0,l.g2)("b-modal"),$e=(0,l.g2)("b-form-invalid-feedback"),we=(0,l.g2)("validation-provider"),Pe=(0,l.g2)("b-form-textarea"),Ce=(0,l.g2)("b-form"),Re=(0,l.g2)("validation-observer"),Te=(0,l.gN)("b-toggle");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.bF)(re,{page:e.$t("SalesReturn"),folder:e.$t("ListReturns")},null,8,["page","folder"]),Z.isLoading?((0,l.uX)(),(0,l.CE)("div",r)):((0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(pe,{mode:"remote",columns:ae.columns,totalRows:Z.totalRows,rows:Z.sales_return,onOnPageChange:ae.onPageChange,onOnPerPageChange:ae.onPerPageChange,onOnSortChange:ae.onSortChange,onOnSearch:ae.onSearch,"search-options":{placeholder:e.$t("Search_this_table"),enabled:!0},"select-options":{enabled:!0,clearSelectionText:""},onOnSelectedRowsChange:ae.selectionChanged,"pagination-options":{enabled:!0,mode:"records",nextLabel:"next",prevLabel:"prev"},styleClass:Z.showDropdown?"tableOne table-hover vgt-table full-height":"tableOne table-hover vgt-table non-height"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t[0]||(t[0]=e=>ae.delete_by_selected())},(0,s.v_)(e.$t("Del")),1)]),(0,l.Lk)("div",u,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(de,{variant:"outline-info ripple m-1",size:"sm"},{default:(0,l.k6)((()=>[c,(0,l.eW)(" "+(0,s.v_)(e.$t("Filter")),1)])),_:1})),[[Te,void 0,void 0,{"sidebar-right":!0}]]),(0,l.bF)(de,{onClick:t[1]||(t[1]=e=>ae.Sale_Return_PDF()),size:"sm",variant:"outline-success ripple m-1"},{default:(0,l.k6)((()=>[m,(0,l.eW)(" PDF ")])),_:1}),(0,l.bF)(ue,{class:"btn btn-sm btn-outline-danger ripple m-1",data:Z.sales_return,columns:ae.columns,"file-name":"sales_return","file-type":"xlsx","sheet-name":"sales_return"},{default:(0,l.k6)((()=>[h,(0,l.eW)(" EXCEL ")])),_:1},8,["data","columns"])]),(0,l.Lk)("template",_,["actions"==e.props.column.field?((0,l.uX)(),(0,l.CE)("span",p,[(0,l.Lk)("div",null,[(0,l.bF)(he,{id:"dropdown-left",variant:"link",text:"Left align","toggle-class":"text-decoration-none",size:"lg","no-caret":""},{"button-content":(0,l.k6)((()=>[b,f,g])),default:(0,l.k6)((()=>[(0,l.bF)(me,null,{default:(0,l.k6)((()=>[(0,l.bF)(ce,{title:"Show",to:"/app/sale_return/detail/"+e.props.row.id},{default:(0,l.k6)((()=>[v,(0,l.eW)(" "+(0,s.v_)(e.$t("ReturnDetail")),1)])),_:1},8,["to"])])),_:1}),e.currentUserPermissions.includes("Sale_Returns_edit")?((0,l.uX)(),(0,l.Wv)(ce,{key:0,title:"Edit",to:"/app/sale_return/edit/"+e.props.row.id+"/"+e.props.row.sale_id},{default:(0,l.k6)((()=>[k,(0,l.eW)(" "+(0,s.v_)(e.$t("EditReturn")),1)])),_:1},8,["to"])):(0,l.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_view")?((0,l.uX)(),(0,l.Wv)(ce,{key:1,onClick:t[2]||(t[2]=t=>ae.Show_Payments(e.props.row.id,e.props.row))},{default:(0,l.k6)((()=>[y,(0,l.eW)(" "+(0,s.v_)(e.$t("ShowPayment")),1)])),_:1})):(0,l.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_add")?((0,l.uX)(),(0,l.Wv)(ce,{key:2,onClick:t[3]||(t[3]=t=>ae.New_Payment(e.props.row))},{default:(0,l.k6)((()=>[F,(0,l.eW)(" "+(0,s.v_)(e.$t("AddPayment")),1)])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(ce,{title:"PDF",onClick:t[4]||(t[4]=t=>ae.Return_PDF(e.props.row,e.props.row.id))},{default:(0,l.k6)((()=>[$,(0,l.eW)(" "+(0,s.v_)(e.$t("DownloadPdf")),1)])),_:1}),e.currentUserPermissions.includes("Sale_Returns_delete")?((0,l.uX)(),(0,l.Wv)(ce,{key:3,title:"Delete",onClick:t[5]||(t[5]=t=>ae.Remove_Return(e.props.row.id))},{default:(0,l.k6)((()=>[w,(0,l.eW)(" "+(0,s.v_)(e.$t("DeleteReturn")),1)])),_:1})):(0,l.Q3)("",!0)])),_:1})])])):"statut"==e.props.column.field?((0,l.uX)(),(0,l.CE)("div",P,["received"==e.props.row.statut?((0,l.uX)(),(0,l.CE)("span",C,(0,s.v_)(e.$t("Received")),1)):((0,l.uX)(),(0,l.CE)("span",R,(0,s.v_)(e.$t("Pending")),1))])):"payment_status"==e.props.column.field?((0,l.uX)(),(0,l.CE)("div",T,["paid"==e.props.row.payment_status?((0,l.uX)(),(0,l.CE)("span",x,(0,s.v_)(e.$t("Paid")),1)):"partial"==e.props.row.payment_status?((0,l.uX)(),(0,l.CE)("span",S,(0,s.v_)(e.$t("partial")),1)):((0,l.uX)(),(0,l.CE)("span",L,(0,s.v_)(e.$t("Unpaid")),1))])):"Ref"==e.props.column.field?((0,l.uX)(),(0,l.CE)("div",D,[(0,l.bF)(_e,{to:"/app/sale_return/detail/"+e.props.row.id},{default:(0,l.k6)((()=>[(0,l.Lk)("span",E,(0,s.v_)(e.props.row.Ref),1)])),_:1},8,["to"])])):"sale_ref"==e.props.column.field&&e.props.row.sale_id?((0,l.uX)(),(0,l.CE)("div",V,[(0,l.bF)(_e,{to:"/app/sales/detail/"+e.props.row.sale_id},{default:(0,l.k6)((()=>[(0,l.Lk)("span",U,(0,s.v_)(e.props.row.sale_ref),1)])),_:1},8,["to"])])):(0,l.Q3)("",!0)])])),_:1},8,["columns","totalRows","rows","onOnPageChange","onOnPerPageChange","onOnSortChange","onOnSearch","search-options","onOnSelectedRowsChange","styleClass"])])),(0,l.bF)(ye,{id:"sidebar-right",title:e.$t("Filter"),"bg-variant":"white",right:"",shadow:""},{default:(0,l.k6)((()=>[(0,l.Lk)("div",A,[(0,l.bF)(ke,null,{default:(0,l.k6)((()=>[(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("date")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{type:"date",modelValue:Z.Filter_date,"onUpdate:modelValue":t[6]||(t[6]=e=>Z.Filter_date=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Reference")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{label:"Reference",placeholder:e.$t("Reference"),modelValue:Z.Filter_Ref,"onUpdate:modelValue":t[7]||(t[7]=e=>Z.Filter_Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Sale")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{reduce:e=>e.value,placeholder:e.$t("Choose_Sale_Ref"),modelValue:Z.Filter_sale,"onUpdate:modelValue":t[8]||(t[8]=e=>Z.Filter_sale=e),options:Z.sales.map((e=>({label:e.Ref,value:e.id})))},null,8,["reduce","placeholder","modelValue","options"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Customer")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{reduce:e=>e.value,placeholder:e.$t("Choose_Customer"),modelValue:Z.Filter_Client,"onUpdate:modelValue":t[9]||(t[9]=e=>Z.Filter_Client=e),options:Z.customers.map((e=>({label:e.name,value:e.id})))},null,8,["reduce","placeholder","modelValue","options"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("warehouse")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{modelValue:Z.Filter_warehouse,"onUpdate:modelValue":t[10]||(t[10]=e=>Z.Filter_warehouse=e),reduce:e=>e.value,placeholder:e.$t("Choose_Warehouse"),options:Z.warehouses.map((e=>({label:e.name,value:e.id})))},null,8,["modelValue","reduce","placeholder","options"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Status")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{modelValue:Z.Filter_status,"onUpdate:modelValue":t[11]||(t[11]=e=>Z.Filter_status=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"completed",value:"completed"},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("PaymentStatus")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{modelValue:Z.Filter_Payment,"onUpdate:modelValue":t[12]||(t[12]=e=>Z.Filter_Payment=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"Paid",value:"paid"},{label:"partial",value:"partial"},{label:"UnPaid",value:"unpaid"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"6",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{onClick:t[13]||(t[13]=e=>ae.GET_Sales_Return(Z.serverParams.page)),variant:"primary ripple m-1",size:"sm"},{default:(0,l.k6)((()=>[W,(0,l.eW)(" "+(0,s.v_)(e.$t("Filter")),1)])),_:1})])),_:1}),(0,l.bF)(ge,{md:"6",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{onClick:t[14]||(t[14]=e=>ae.Reset_Filter()),variant:"danger ripple m-1",size:"sm"},{default:(0,l.k6)((()=>[B,(0,l.eW)(" "+(0,s.v_)(e.$t("Reset")),1)])),_:1})])),_:1})])),_:1})])])),_:1},8,["title"]),(0,l.bF)(Fe,{"hide-footer":"",size:"lg",id:"Show_payment",title:e.$t("ShowPayment")},{default:(0,l.k6)((()=>[(0,l.bF)(ke,null,{default:(0,l.k6)((()=>[(0,l.bF)(ge,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",X,[(0,l.Lk)("table",O,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",G,(0,s.v_)(e.$t("date")),1),(0,l.Lk)("th",M,(0,s.v_)(e.$t("Reference")),1),(0,l.Lk)("th",N,(0,s.v_)(e.$t("Amount")),1),(0,l.Lk)("th",K,(0,s.v_)(e.$t("PayeBy")),1),(0,l.Lk)("th",I,(0,s.v_)(e.$t("Action")),1)])]),(0,l.Lk)("tbody",null,[Z.factures.length<=0?((0,l.uX)(),(0,l.CE)("tr",Q,[(0,l.Lk)("td",q,(0,s.v_)(e.$t("NodataAvailable")),1)])):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Z.factures,(t=>((0,l.uX)(),(0,l.CE)("tr",null,[(0,l.Lk)("td",null,(0,s.v_)(t.date),1),(0,l.Lk)("td",null,(0,s.v_)(t.Ref),1),(0,l.Lk)("td",null,(0,s.v_)(e.currentUser.currency)+" "+(0,s.v_)(ae.formatNumber(t.montant,2)),1),(0,l.Lk)("td",null,(0,s.v_)(t.Reglement),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",z,[(0,l.Lk)("span",{title:"Print",class:"btn btn-icon btn-info btn-sm",onClick:e=>ae.Payment_Return_PDF(t,t.id)},H,8,j),e.currentUserPermissions.includes("payment_returns_edit")?((0,l.uX)(),(0,l.CE)("span",{key:0,title:"Edit",class:"btn btn-icon btn-success btn-sm",onClick:e=>ae.Edit_Payment(t)},ee,8,J)):(0,l.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_delete")?((0,l.uX)(),(0,l.CE)("span",{key:1,title:"Delete",class:"btn btn-icon btn-danger btn-sm",onClick:e=>ae.Remove_Payment(t.id)},le,8,te)):(0,l.Q3)("",!0)])])])))),256))])])])])),_:1})])),_:1})])),_:1},8,["title"]),(0,l.bF)(Re,{ref:"Add_payment"},{default:(0,l.k6)((()=>[(0,l.bF)(Fe,{"hide-footer":"",size:"lg",id:"Add_Payment",title:Z.EditPaiementMode?e.$t("EditPayment"):e.$t("AddPayment")},{default:(0,l.k6)((()=>[(0,l.bF)(Ce,{onSubmit:(0,n.D$)(ae.Submit_Payment,["prevent"])},{default:(0,l.k6)((()=>[(0,l.bF)(ke,null,{default:(0,l.k6)((()=>[(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(we,{name:"date",rules:{required:!0}},{default:(0,l.k6)((a=>[(0,l.bF)(fe,{label:e.$t("date")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{label:"date",state:ae.getValidationState(a),"aria-describedby":"date-feedback",modelValue:Z.facture.date,"onUpdate:modelValue":t[15]||(t[15]=e=>Z.facture.date=e),type:"date"},null,8,["state","modelValue"]),(0,l.bF)($e,{id:"date-feedback"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Reference")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{disabled:"disabled",label:"Reference",placeholder:e.$t("Reference"),modelValue:Z.facture.Ref,"onUpdate:modelValue":t[16]||(t[16]=e=>Z.facture.Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(we,{name:"Payment choice",rules:{required:!0}},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{"slot-scope":"{ valid, errors }",label:e.$t("Paymentchoice")},{default:(0,l.k6)((()=>[(0,l.bF)(ve,{class:(0,s.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:Z.facture.Reglement,"onUpdate:modelValue":t[17]||(t[17]=e=>Z.facture.Reglement=e),onInput:e.Selected_PaymentMethod,reduce:e=>e.value,placeholder:e.$t("PleaseSelect"),options:[{label:"Cash",value:"Cash"},{label:"credit card",value:"credit card"},{label:"TPE",value:"tpe"},{label:"cheque",value:"cheque"},{label:"Western Union",value:"Western Union"},{label:"bank transfer",value:"bank transfer"},{label:"other",value:"other"}]},null,8,["class","state","modelValue","onInput","reduce","placeholder"]),(0,l.bF)($e,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(we,{name:"Received Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,l.k6)((a=>[(0,l.bF)(fe,{label:e.$t("Received_Amount")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{onKeyup:t[18]||(t[18]=e=>ae.Verified_Received_Amount(Z.facture.received_amount)),label:"Received_Amount",placeholder:e.$t("Received_Amount"),modelValue:Z.facture.received_amount,"onUpdate:modelValue":t[19]||(t[19]=e=>Z.facture.received_amount=e),modelModifiers:{number:!0},state:ae.getValidationState(a),"aria-describedby":"Received_Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,l.bF)($e,{id:"Received_Amount-feedback"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(we,{name:"Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,l.k6)((a=>[(0,l.bF)(fe,{label:e.$t("Paying_Amount")},{default:(0,l.k6)((()=>[(0,l.bF)(be,{onKeyup:t[20]||(t[20]=e=>ae.Verified_paidAmount(Z.facture.montant)),label:"Amount",placeholder:e.$t("Paying_Amount"),modelValue:Z.facture.montant,"onUpdate:modelValue":t[21]||(t[21]=e=>Z.facture.montant=e),modelModifiers:{number:!0},state:ae.getValidationState(a),"aria-describedby":"Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,l.bF)($e,{id:"Amount-feedback"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,l.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,l.k6)((()=>[(0,l.Lk)("label",null,(0,s.v_)(e.$t("Change"))+" :",1),(0,l.Lk)("p",se,(0,s.v_)(parseFloat(Z.facture.received_amount-Z.facture.montant).toFixed(2)),1)])),_:1}),(0,l.bF)(ge,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,l.k6)((()=>[(0,l.bF)(fe,{label:e.$t("Note")},{default:(0,l.k6)((()=>[(0,l.bF)(Pe,{id:"textarea",modelValue:Z.facture.notes,"onUpdate:modelValue":t[22]||(t[22]=e=>Z.facture.notes=e),rows:"3","max-rows":"6"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,l.bF)(ge,{md:"12",class:"mt-3"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{variant:"primary",type:"submit",disabled:Z.paymentProcessing},{default:(0,l.k6)((()=>[ne,(0,l.eW)(" "+(0,s.v_)(e.$t("submit")),1)])),_:1},8,["disabled"]),t[23]||((0,l.Vq)(-1),t[23]=Z.paymentProcessing?((0,l.uX)(),(0,l.CE)("div",ie,oe)):(0,l.Q3)("",!0),(0,l.Vq)(1),t[23])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["title"])])),_:1},512)])}var ue=a(95353),ce=a(5947),me=a.n(ce),he=a(44323);a(13246);const _e={metaInfo:{title:"Sale Return"},data(){return{paymentProcessing:!1,isLoading:!0,serverParams:{sort:{field:"id",type:"desc"},page:1,perPage:10},selectedIds:[],search:"",totalRows:"",submitStatus:null,showDropdown:!1,EditPaiementMode:!1,Filter_Client:"",Filter_sale:"",Filter_status:"",Filter_Payment:"",Filter_Ref:"",Filter_date:"",Filter_warehouse:"",due:0,return_sale_due:"",sales_return:[],sale_return:{},customers:[],sales:[],warehouses:[],sale_return_id:"",factures:[],limit:"10",facture:{id:"",sale_return_id:"",date:"",Ref:"",montant:"",received_amount:"",Reglement:"",notes:""}}},mounted(){this.$root.$on("bv::dropdown::show",(e=>{this.showDropdown=!0})),this.$root.$on("bv::dropdown::hide",(e=>{this.showDropdown=!1}))},computed:{...(0,ue.L8)(["currentUserPermissions","currentUser"]),columns(){return[{label:this.$t("date"),field:"date",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Reference"),field:"Ref",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Customer"),field:"client_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("warehouse"),field:"warehouse_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Sale_Ref"),field:"sale_ref",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Status"),field:"statut",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Total"),field:"GrandTotal",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Paid"),field:"paid_amount",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Due"),field:"due",tdClass:"text-left",thClass:"text-left"},{label:this.$t("PaymentStatus"),field:"payment_status",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Action"),field:"actions",html:!0,tdClass:"text-right",thClass:"text-right",sortable:!1}]}},methods:{updateParams(e){this.serverParams=Object.assign({},this.serverParams,e)},onPageChange({currentPage:e}){this.serverParams.page!==e&&(this.updateParams({page:e}),this.GET_Sales_Return(e))},onPerPageChange({currentPerPage:e}){this.limit!==e&&(this.limit=e,this.updateParams({page:1,perPage:e}),this.GET_Sales_Return(1))},selectionChanged({selectedRows:e}){this.selectedIds=[],e.forEach(((e,t)=>{this.selectedIds.push(e.id)}))},onSortChange(e){let t="";t="client_name"==e[0].field?"client_id":"warehouse_name"==e[0].field?"warehouse_id":"sale_ref"==e[0].field?"sale_id":e[0].field,this.updateParams({sort:{type:e[0].type,field:t}}),this.GET_Sales_Return(this.serverParams.page)},onSearch(e){this.search=e.searchTerm,this.GET_Sales_Return(this.serverParams.page)},Submit_Payment(){this.$refs.Add_payment.validate().then((e=>{e&&(this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.received_amount=0):this.facture.montant>this.due?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0):this.EditPaiementMode?this.Update_Payment():this.Create_Payment())}))},Verified_paidAmount(){isNaN(this.facture.montant)?this.facture.montant=0:this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.montant=0):this.facture.montant>this.due&&(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0)},Verified_Received_Amount(){isNaN(this.facture.received_amount)&&(this.facture.received_amount=0)},getValidationState({dirty:e,validated:t,valid:a=null}){return e||t?a:null},makeToast(e,t,a){this.$root.$bvToast.toast(t,{title:a,variant:e,solid:!0})},Reset_Filter(){this.search="",this.Filter_Client="",this.Filter_sale="",this.Filter_status="",this.Filter_Payment="",this.Filter_Ref="",this.Filter_date="",this.Filter_warehouse="",this.GET_Sales_Return(this.serverParams.page)},setToStrings(){null===this.Filter_Client?this.Filter_Client="":null===this.Filter_warehouse?this.Filter_warehouse="":null===this.Filter_status?this.Filter_status="":null===this.Filter_Payment?this.Filter_Payment="":null===this.Filter_sale&&(this.Filter_sale="")},formatNumber(e,t){const a=("string"===typeof e?e:e.toString()).split(".");if(t<=0)return a[0];let l=a[1]||"";if(l.length>t)return`${a[0]}.${l.substr(0,t)}`;while(l.length<t)l+="0";return`${a[0]}.${l}`},Return_PDF(e,t){me().start(),me().set(.1),axios.get("return_sale_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=a,l.setAttribute("download","Return-Sale-"+e.Ref+".pdf"),document.body.appendChild(l),l.click(),setTimeout((()=>me().done()),500)})).catch((()=>{setTimeout((()=>me().done()),500)}))},Payment_Return_PDF(e,t){me().start(),me().set(.1),axios.get("payment_return_sale_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=a,l.setAttribute("download","Payment-"+e.Ref+".pdf"),document.body.appendChild(l),l.click(),setTimeout((()=>me().done()),500)})).catch((()=>{setTimeout((()=>me().done()),500)}))},Sale_Return_PDF(){var e=this;let t=new he["default"]("p","pt"),a=[{title:"Ref",dataKey:"Ref"},{title:"Client",dataKey:"client_name"},{title:"Warehouse",dataKey:"warehouse_name"},{title:"sale_ref",dataKey:"sale_ref"},{title:"Status",dataKey:"statut"},{title:"Total",dataKey:"GrandTotal"},{title:"Paid",dataKey:"paid_amount"},{title:"Due",dataKey:"due"},{title:"Status Payment",dataKey:"payment_status"}];t.autoTable(a,e.sales_return),t.text("Sales Return List",40,25),t.save("Sales Return.pdf")},Number_Order_Payment(){axios.get("payment/returns_sale/Number/order").then((({data:e})=>this.facture.Ref=e))},New_Payment(e){"paid"==e.payment_status?this.$swal({icon:"error",title:"Oops...",text:this.$t("PaymentComplete")}):(me().start(),me().set(.1),this.reset_form_payment(),this.EditPaiementMode=!1,this.sale_return=e,this.facture.date=(new Date).toISOString().slice(0,10),this.Number_Order_Payment(),this.facture.montant=parseFloat(e.due),this.facture.Reglement="Cash",this.facture.received_amount=parseFloat(e.due),this.due=parseFloat(e.due),setTimeout((()=>{me().done(),this.$bvModal.show("Add_Payment")}),500))},Edit_Payment(e){me().start(),me().set(.1),this.reset_form_payment(),this.EditPaiementMode=!0,this.facture.id=e.id,this.facture.Ref=e.Ref,this.facture.Reglement=e.Reglement,this.facture.date=e.date,this.facture.change=e.change,this.facture.montant=parseFloat(e.montant),this.facture.received_amount=parseFloat(e.montant+e.change),this.facture.notes=e.notes,this.due=parseFloat(this.return_sale_due)+e.montant,setTimeout((()=>{me().done(),this.$bvModal.show("Add_Payment")}),1e3)},reset_form_payment(){this.due=0,this.facture={id:"",sale_return_id:"",date:"",Ref:"",montant:"",received_amount:"",Reglement:"",notes:""}},Show_Payments(e,t){me().start(),me().set(.1),this.reset_form_payment(),this.sale_return_id=e,this.sale_return=t,this.Get_Payments(e)},Get_Payments(e){axios.get("returns/sale/payment/"+e).then((e=>{this.factures=e.data.payments,this.return_sale_due=e.data.due,setTimeout((()=>{me().done(),this.$bvModal.show("Show_payment")}),500)})).catch((()=>{setTimeout((()=>me().done()),500)}))},GET_Sales_Return(e){me().start(),me().set(.1),this.setToStrings(),axios.get("returns/sale?page="+e+"&Ref="+this.Filter_Ref+"&date="+this.Filter_date+"&sale_id="+this.Filter_sale+"&client_id="+this.Filter_Client+"&statut="+this.Filter_status+"&warehouse_id="+this.Filter_warehouse+"&payment_statut="+this.Filter_Payment+"&SortField="+this.serverParams.sort.field+"&SortType="+this.serverParams.sort.type+"&search="+this.search+"&limit="+this.limit).then((e=>{this.sales_return=e.data.sale_Return,this.customers=e.data.customers,this.sales=e.data.sales,this.warehouses=e.data.warehouses,this.totalRows=e.data.totalRows,me().done(),this.isLoading=!1})).catch((e=>{me().done(),setTimeout((()=>{this.isLoading=!1}),500)}))},Remove_Return(e){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(me().start(),me().set(.1),axios.delete("returns/sale/"+e).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.ReturnDeleted"),"success"),Fire.$emit("Delete_Return_sale")})).catch((()=>{setTimeout((()=>me().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},delete_by_selected(){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((e=>{e.value&&(me().start(),me().set(.1),axios.post("returns/sale/delete/by_selection",{selectedIds:this.selectedIds}).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.ReturnDeleted"),"success"),Fire.$emit("Delete_Return_sale")})).catch((()=>{setTimeout((()=>me().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},Create_Payment(){this.paymentProcessing=!0,me().start(),me().set(.1),axios.post("payment/returns_sale",{sale_return_id:this.sale_return.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),Reglement:this.facture.Reglement,notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Create_payment_Return_sale"),this.makeToast("success",this.$t("Create.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,me().done()}))},Update_Payment(){this.paymentProcessing=!0,me().start(),me().set(.1),axios.put("payment/returns_sale/"+this.facture.id,{sale_return_id:this.sale_return.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),Reglement:this.facture.Reglement,notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Update_payment_Return_sale"),this.makeToast("success",this.$t("Update.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,me().done()}))},Remove_Payment(e){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(me().start(),me().set(.1),axios.delete("payment/returns_sale/"+e).then((()=>{this.makeToast("success",this.$t("Delete.PaymentDeleted"),this.$t("Delete.Deleted")),Fire.$emit("Delete_payment_Return_sale")})).catch((()=>{setTimeout((()=>me().done()),500),this.makeToast("warning",this.$t("Delete.Therewassomethingwronge"),this.$t("Delete.Failed"))})))}))}},created(){this.GET_Sales_Return(1),Fire.$on("Create_payment_Return_sale",(()=>{setTimeout((()=>{this.GET_Sales_Return(this.serverParams.page),me().done()}),800),this.$bvModal.hide("Add_Payment")})),Fire.$on("Update_payment_Return_sale",(()=>{setTimeout((()=>{this.GET_Sales_Return(this.serverParams.page),me().done(),this.$bvModal.hide("Add_Payment"),this.$bvModal.hide("Show_payment")}),800)})),Fire.$on("Delete_payment_Return_sale",(()=>{setTimeout((()=>{this.GET_Sales_Return(this.serverParams.page),me().done(),this.$bvModal.hide("Show_payment")}),800)})),Fire.$on("Delete_Return_sale",(()=>{setTimeout((()=>{this.GET_Sales_Return(this.serverParams.page),me().done()}),800)}))}};var pe=a(66262);const be=(0,pe.A)(_e,[["render",de]]),fe=be}}]);
//# sourceMappingURL=index_sale_return.6a365d61.js.map