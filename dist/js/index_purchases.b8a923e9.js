"use strict";(self["webpackChunk"]=self["webpackChunk"]||[]).push([[8756],{73869:(e,t,a)=>{a.r(t),a.d(t,{default:()=>De});var s=a(20641),l=a(90033),i=a(53751);const n={class:"main-content"},r={key:0,class:"loading_page spinner spinner-primary mr-3"},o={key:1},d={slot:"selected-row-actions"},u={slot:"table-actions",class:"mt-2 mb-3"},c=(0,s.Lk)("i",{class:"i-Filter-2"},null,-1),h=(0,s.Lk)("i",{class:"i-File-Copy"},null,-1),m=(0,s.Lk)("i",{class:"i-File-Excel"},null,-1),p=(0,s.Lk)("span",{class:"ul-btn__icon"},[(0,s.Lk)("i",{class:"i-Add"})],-1),_={class:"ul-btn__text ml-1"},b={slot:"table-row","slot-scope":"props"},f={key:0},g=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),k=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),v=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),P=(0,s.Lk)("i",{class:"nav-icon i-Eye font-weight-bold mr-2"},null,-1),y=(0,s.Lk)("i",{class:"nav-icon i-Pen-2 font-weight-bold mr-2"},null,-1),F=(0,s.Lk)("i",{class:"nav-icon i-Back font-weight-bold mr-2"},null,-1),$=(0,s.Lk)("i",{class:"nav-icon i-Back font-weight-bold mr-2"},null,-1),w=(0,s.Lk)("i",{class:"nav-icon i-Money-Bag font-weight-bold mr-2"},null,-1),C=(0,s.Lk)("i",{class:"nav-icon i-Add font-weight-bold mr-2"},null,-1),S=(0,s.Lk)("i",{class:"nav-icon i-File-TXT font-weight-bold mr-2"},null,-1),T=(0,s.Lk)("i",{class:"nav-icon i-Envelope-2 font-weight-bold mr-2"},null,-1),x=(0,s.Lk)("i",{class:"nav-icon i-Speach-Bubble font-weight-bold mr-2"},null,-1),R=(0,s.Lk)("i",{class:"nav-icon i-Close-Window font-weight-bold mr-2"},null,-1),L={key:1},D={key:0,class:"badge badge-outline-success"},E={key:1,class:"badge badge-outline-info"},V={key:2,class:"badge badge-outline-warning"},W={key:2},U={key:0,class:"badge badge-outline-success"},A={key:1,class:"badge badge-outline-primary"},B={key:2,class:"badge badge-outline-warning"},X={key:3},M={class:"ul-btn__text ml-1"},O=(0,s.Lk)("br",null,null,-1),G={key:0},I=(0,s.Lk)("i",{class:"text-15 text-danger i-Back"},null,-1),N=[I],Q={class:"px-3 py-2"},K=(0,s.Lk)("i",{class:"i-Filter-2"},null,-1),q=(0,s.Lk)("i",{class:"i-Power-2"},null,-1),j={class:"table-responsive"},z={class:"table table-hover table-bordered table-md"},Y={scope:"col"},H={scope:"col"},J={scope:"col"},Z={scope:"col"},ee={scope:"col"},te={key:0},ae={colspan:"5"},se={role:"group","aria-label":"Basic example",class:"btn-group"},le=["onClick"],ie=(0,s.Lk)("i",{class:"i-Billing"},null,-1),ne=[ie],re=["onClick"],oe=(0,s.Lk)("i",{class:"i-Pen-2"},null,-1),de=[oe],ue=["onClick"],ce=(0,s.Lk)("i",{class:"i-Envelope"},null,-1),he=[ce],me=["onClick"],pe=(0,s.Lk)("i",{class:"i-Speach-Bubble"},null,-1),_e=[pe],be=["onClick"],fe=(0,s.Lk)("i",{class:"i-Close"},null,-1),ge=[fe],ke={class:"change_amount"},ve=(0,s.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),Pe={key:0,class:"typo__p"},ye=(0,s.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),Fe=[ye];function $e(e,t,a,I,ie,oe){const ce=(0,s.g2)("breadcumb"),pe=(0,s.g2)("b-button"),fe=(0,s.g2)("vue-excel-xlsx"),ye=(0,s.g2)("router-link"),$e=(0,s.g2)("b-dropdown-item"),we=(0,s.g2)("b-dropdown"),Ce=(0,s.g2)("vue-good-table"),Se=(0,s.g2)("b-form-input"),Te=(0,s.g2)("b-form-group"),xe=(0,s.g2)("b-col"),Re=(0,s.g2)("v-select"),Le=(0,s.g2)("b-row"),De=(0,s.g2)("b-sidebar"),Ee=(0,s.g2)("b-modal"),Ve=(0,s.g2)("b-form-invalid-feedback"),We=(0,s.g2)("validation-provider"),Ue=(0,s.g2)("b-form-textarea"),Ae=(0,s.g2)("b-form"),Be=(0,s.g2)("validation-observer"),Xe=(0,s.gN)("b-toggle");return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(ce,{page:e.$t("ListPurchases"),folder:e.$t("Purchases")},null,8,["page","folder"]),ie.isLoading?((0,s.uX)(),(0,s.CE)("div",r)):((0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(Ce,{mode:"remote",columns:oe.columns,totalRows:ie.totalRows,rows:ie.purchases,onOnPageChange:oe.onPageChange,onOnPerPageChange:oe.onPerPageChange,onOnSortChange:oe.onSortChange,onOnSearch:oe.onSearch,"search-options":{placeholder:e.$t("Search_this_table"),enabled:!0},"select-options":{enabled:!0,clearSelectionText:""},onOnSelectedRowsChange:oe.selectionChanged,"pagination-options":{enabled:!0,mode:"records",nextLabel:"next",prevLabel:"prev"},styleClass:ie.showDropdown?"tableOne table-hover vgt-table full-height":"tableOne table-hover vgt-table non-height"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",d,[(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t[0]||(t[0]=e=>oe.delete_by_selected())},(0,l.v_)(e.$t("Del")),1)]),(0,s.Lk)("div",u,[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(pe,{variant:"outline-info ripple m-1",size:"sm"},{default:(0,s.k6)((()=>[c,(0,s.eW)(" "+(0,l.v_)(e.$t("Filter")),1)])),_:1})),[[Xe,void 0,void 0,{"sidebar-right":!0}]]),(0,s.bF)(pe,{onClick:t[1]||(t[1]=e=>oe.Purchase_PDF()),size:"sm",variant:"outline-success ripple m-1"},{default:(0,s.k6)((()=>[h,(0,s.eW)(" PDF ")])),_:1}),(0,s.bF)(fe,{class:"btn btn-sm btn-outline-danger ripple m-1",data:ie.purchases,columns:oe.columns,"file-name":"purchases","file-type":"xlsx","sheet-name":"purchases"},{default:(0,s.k6)((()=>[m,(0,s.eW)(" EXCEL ")])),_:1},8,["data","columns"]),e.currentUserPermissions&&e.currentUserPermissions.includes("Purchases_add")?((0,s.uX)(),(0,s.Wv)(ye,{key:0,class:"btn-sm btn btn-primary ripple btn-icon m-1",to:"/app/purchases/store"},{default:(0,s.k6)((()=>[p,(0,s.Lk)("span",_,(0,l.v_)(e.$t("Add")),1)])),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("template",b,["actions"==e.props.column.field?((0,s.uX)(),(0,s.CE)("span",f,[(0,s.Lk)("div",null,[(0,s.bF)(we,{id:"dropdown-left",variant:"link",text:"Left align","toggle-class":"text-decoration-none",size:"lg","no-caret":""},{"button-content":(0,s.k6)((()=>[g,k,v])),default:(0,s.k6)((()=>[(0,s.bF)($e,{title:"Show",to:"/app/purchases/detail/"+e.props.row.id},{default:(0,s.k6)((()=>[P,(0,s.eW)(" "+(0,l.v_)(e.$t("PurchaseDetail")),1)])),_:1},8,["to"]),e.currentUserPermissions.includes("Purchases_edit")&&"no"==e.props.row.purchase_has_return?((0,s.uX)(),(0,s.Wv)($e,{key:0,title:"Edit",to:"/app/purchases/edit/"+e.props.row.id},{default:(0,s.k6)((()=>[y,(0,s.eW)(" "+(0,l.v_)(e.$t("EditPurchase")),1)])),_:1},8,["to"])):(0,s.Q3)("",!0),e.currentUserPermissions.includes("Purchase_Returns_add")&&"no"==e.props.row.purchase_has_return?((0,s.uX)(),(0,s.Wv)($e,{key:1,title:"Purchase Return",to:"/app/purchases/purchase_return/"+e.props.row.id},{default:(0,s.k6)((()=>[F,(0,s.eW)(" "+(0,l.v_)(e.$t("Purchase_Return")),1)])),_:1},8,["to"])):(0,s.Q3)("",!0),e.currentUserPermissions.includes("Purchase_Returns_add")&&"yes"==e.props.row.purchase_has_return?((0,s.uX)(),(0,s.Wv)($e,{key:2,title:"Purchase Return",to:"/app/purchase_return/edit/"+e.props.row.purchasereturn_id+"/"+e.props.row.id},{default:(0,s.k6)((()=>[$,(0,s.eW)(" "+(0,l.v_)(e.$t("Purchase_Return")),1)])),_:1},8,["to"])):(0,s.Q3)("",!0),e.currentUserPermissions.includes("payment_purchases_view")?((0,s.uX)(),(0,s.Wv)($e,{key:3,onClick:t[2]||(t[2]=t=>oe.Show_Payments(e.props.row.id,e.props.row))},{default:(0,s.k6)((()=>[w,(0,s.eW)(" "+(0,l.v_)(e.$t("ShowPayment")),1)])),_:1})):(0,s.Q3)("",!0),e.currentUserPermissions.includes("payment_purchases_add")?((0,s.uX)(),(0,s.Wv)($e,{key:4,onClick:t[3]||(t[3]=t=>oe.New_Payment(e.props.row))},{default:(0,s.k6)((()=>[C,(0,s.eW)(" "+(0,l.v_)(e.$t("AddPayment")),1)])),_:1})):(0,s.Q3)("",!0),(0,s.bF)($e,{title:"PDF",onClick:t[4]||(t[4]=t=>oe.Invoice_PDF(e.props.row,e.props.row.id))},{default:(0,s.k6)((()=>[S,(0,s.eW)(" "+(0,l.v_)(e.$t("DownloadPdf")),1)])),_:1}),(0,s.bF)($e,{title:"Email",onClick:t[5]||(t[5]=t=>oe.Send_Email(e.props.row.id))},{default:(0,s.k6)((()=>[T,(0,s.eW)(" "+(0,l.v_)(e.$t("email_notification")),1)])),_:1}),(0,s.bF)($e,{title:"SMS",onClick:t[6]||(t[6]=t=>oe.Purchase_SMS(e.props.row.id))},{default:(0,s.k6)((()=>[x,(0,s.eW)(" "+(0,l.v_)(e.$t("sms_notification")),1)])),_:1}),e.currentUserPermissions.includes("Purchases_delete")?((0,s.uX)(),(0,s.Wv)($e,{key:5,title:"Delete",onClick:t[7]||(t[7]=t=>oe.Remove_Purchase(e.props.row.id,e.props.row.purchase_has_return))},{default:(0,s.k6)((()=>[R,(0,s.eW)(" "+(0,l.v_)(e.$t("DeletePurchase")),1)])),_:1})):(0,s.Q3)("",!0)])),_:1})])])):"statut"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",L,["received"==e.props.row.statut?((0,s.uX)(),(0,s.CE)("span",D,(0,l.v_)(e.$t("Received")),1)):"pending"==e.props.row.statut?((0,s.uX)(),(0,s.CE)("span",E,(0,l.v_)(e.$t("Pending")),1)):((0,s.uX)(),(0,s.CE)("span",V,(0,l.v_)(e.$t("Ordered")),1))])):"payment_status"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",W,["paid"==e.props.row.payment_status?((0,s.uX)(),(0,s.CE)("span",U,(0,l.v_)(e.$t("Paid")),1)):"partial"==e.props.row.payment_status?((0,s.uX)(),(0,s.CE)("span",A,(0,l.v_)(e.$t("partial")),1)):((0,s.uX)(),(0,s.CE)("span",B,(0,l.v_)(e.$t("Unpaid")),1))])):"Ref"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.bF)(ye,{to:"/app/purchases/detail/"+e.props.row.id},{default:(0,s.k6)((()=>[(0,s.Lk)("span",M,(0,l.v_)(e.props.row.Ref),1)])),_:1},8,["to"]),(0,s.eW)(),O,"yes"==e.props.row.purchase_has_return?((0,s.uX)(),(0,s.CE)("small",G,N)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])])),_:1},8,["columns","totalRows","rows","onOnPageChange","onOnPerPageChange","onOnSortChange","onOnSearch","search-options","onOnSelectedRowsChange","styleClass"])])),(0,s.bF)(De,{id:"sidebar-right",title:e.$t("Filter"),"bg-variant":"white",right:"",shadow:""},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Q,[(0,s.bF)(Le,null,{default:(0,s.k6)((()=>[(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("date")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{type:"date",modelValue:ie.Filter_date,"onUpdate:modelValue":t[8]||(t[8]=e=>ie.Filter_date=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("Reference")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{label:"Reference",placeholder:e.$t("Reference"),modelValue:ie.Filter_Ref,"onUpdate:modelValue":t[9]||(t[9]=e=>ie.Filter_Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("Supplier")},{default:(0,s.k6)((()=>[(0,s.bF)(Re,{reduce:e=>e.value,placeholder:e.$t("Choose_Supplier"),modelValue:ie.Filter_Supplier,"onUpdate:modelValue":t[10]||(t[10]=e=>ie.Filter_Supplier=e),options:ie.suppliers.map((e=>({label:e.name,value:e.id})))},null,8,["reduce","placeholder","modelValue","options"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("warehouse")},{default:(0,s.k6)((()=>[(0,s.bF)(Re,{modelValue:ie.Filter_warehouse,"onUpdate:modelValue":t[11]||(t[11]=e=>ie.Filter_warehouse=e),reduce:e=>e.value,placeholder:e.$t("Choose_Warehouse"),options:ie.warehouses.map((e=>({label:e.name,value:e.id})))},null,8,["modelValue","reduce","placeholder","options"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("Status")},{default:(0,s.k6)((()=>[(0,s.bF)(Re,{modelValue:ie.Filter_status,"onUpdate:modelValue":t[12]||(t[12]=e=>ie.Filter_status=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"Received",value:"received"},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("PaymentStatus")},{default:(0,s.k6)((()=>[(0,s.bF)(Re,{modelValue:ie.Filter_Payment,"onUpdate:modelValue":t[13]||(t[13]=e=>ie.Filter_Payment=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"Paid",value:"paid"},{label:"partial",value:"partial"},{label:"UnPaid",value:"unpaid"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"6",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(pe,{onClick:t[14]||(t[14]=e=>oe.Get_Purchases(ie.serverParams.page)),variant:"primary ripple m-1",size:"sm",block:""},{default:(0,s.k6)((()=>[K,(0,s.eW)(" "+(0,l.v_)(e.$t("Filter")),1)])),_:1})])),_:1}),(0,s.bF)(xe,{md:"6",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(pe,{onClick:t[15]||(t[15]=e=>oe.Reset_Filter()),variant:"danger ripple m-1",size:"sm",block:""},{default:(0,s.k6)((()=>[q,(0,s.eW)(" "+(0,l.v_)(e.$t("Reset")),1)])),_:1})])),_:1})])),_:1})])])),_:1},8,["title"]),(0,s.bF)(Ee,{"hide-footer":"",size:"lg",id:"Show_payment",title:e.$t("ShowPayment")},{default:(0,s.k6)((()=>[(0,s.bF)(Le,null,{default:(0,s.k6)((()=>[(0,s.bF)(xe,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",j,[(0,s.Lk)("table",z,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",Y,(0,l.v_)(e.$t("date")),1),(0,s.Lk)("th",H,(0,l.v_)(e.$t("Reference")),1),(0,s.Lk)("th",J,(0,l.v_)(e.$t("Amount")),1),(0,s.Lk)("th",Z,(0,l.v_)(e.$t("PayeBy")),1),(0,s.Lk)("th",ee,(0,l.v_)(e.$t("Action")),1)])]),(0,s.Lk)("tbody",null,[ie.factures.length<=0?((0,s.uX)(),(0,s.CE)("tr",te,[(0,s.Lk)("td",ae,(0,l.v_)(e.$t("NodataAvailable")),1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ie.factures,(t=>((0,s.uX)(),(0,s.CE)("tr",null,[(0,s.Lk)("td",null,(0,l.v_)(t.date),1),(0,s.Lk)("td",null,(0,l.v_)(t.Ref),1),(0,s.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(oe.formatNumber(t.montant,2)),1),(0,s.Lk)("td",null,(0,l.v_)(t.Reglement),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",se,[(0,s.Lk)("span",{title:"Print",class:"btn btn-icon btn-info btn-sm",onClick:e=>oe.Payment_Purchase_PDF(t,t.id)},ne,8,le),e.currentUserPermissions.includes("payment_purchases_edit")?((0,s.uX)(),(0,s.CE)("span",{key:0,title:"Edit",class:"btn btn-icon btn-success btn-sm",onClick:e=>oe.Edit_Payment(t)},de,8,re)):(0,s.Q3)("",!0),(0,s.Lk)("span",{title:"Email",class:"btn btn-icon btn-primary btn-sm",onClick:e=>oe.Send_Email_Payment(t.id)},he,8,ue),(0,s.Lk)("span",{title:"SMS",class:"btn btn-icon btn-secondary btn-sm",onClick:e=>oe.Payment_Purchase_SMS(t.id)},_e,8,me),e.currentUserPermissions.includes("payment_purchases_delete")?((0,s.uX)(),(0,s.CE)("span",{key:1,title:"Delete",class:"btn btn-icon btn-danger btn-sm",onClick:e=>oe.Remove_Payment(t.id)},ge,8,be)):(0,s.Q3)("",!0)])])])))),256))])])])])),_:1})])),_:1})])),_:1},8,["title"]),(0,s.bF)(Be,{ref:"Add_payment"},{default:(0,s.k6)((()=>[(0,s.bF)(Ee,{"hide-footer":"",size:"lg",id:"Add_Payment",title:ie.EditPaiementMode?e.$t("EditPayment"):e.$t("AddPayment")},{default:(0,s.k6)((()=>[(0,s.bF)(Ae,{onSubmit:(0,i.D$)(oe.Submit_Payment,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(Le,null,{default:(0,s.k6)((()=>[(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(We,{name:"date",rules:{required:!0}},{default:(0,s.k6)((a=>[(0,s.bF)(Te,{label:e.$t("date")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{label:"date",state:oe.getValidationState(a),"aria-describedby":"date-feedback",modelValue:ie.facture.date,"onUpdate:modelValue":t[16]||(t[16]=e=>ie.facture.date=e),type:"date"},null,8,["state","modelValue"]),(0,s.bF)(Ve,{id:"date-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("Reference")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{disabled:"disabled",label:"Reference",placeholder:e.$t("Reference"),modelValue:ie.facture.Ref,"onUpdate:modelValue":t[17]||(t[17]=e=>ie.facture.Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(We,{name:"Payment choice",rules:{required:!0}},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{"slot-scope":"{ valid, errors }",label:e.$t("Paymentchoice")},{default:(0,s.k6)((()=>[(0,s.bF)(Re,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:ie.facture.Reglement,"onUpdate:modelValue":t[18]||(t[18]=e=>ie.facture.Reglement=e),onInput:e.Selected_PaymentMethod,reduce:e=>e.value,placeholder:e.$t("PleaseSelect"),options:[{label:"Cash",value:"Cash"},{label:"credit card",value:"credit card"},{label:"TPE",value:"tpe"},{label:"cheque",value:"cheque"},{label:"Western Union",value:"Western Union"},{label:"bank transfer",value:"bank transfer"},{label:"other",value:"other"}]},null,8,["class","state","modelValue","onInput","reduce","placeholder"]),(0,s.bF)(Ve,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(We,{name:"Received Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,s.k6)((a=>[(0,s.bF)(Te,{label:e.$t("Received_Amount")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{onKeyup:t[19]||(t[19]=e=>oe.Verified_Received_Amount(ie.facture.received_amount)),label:"Received_Amount",placeholder:e.$t("Received_Amount"),modelValue:ie.facture.received_amount,"onUpdate:modelValue":t[20]||(t[20]=e=>ie.facture.received_amount=e),modelModifiers:{number:!0},state:oe.getValidationState(a),"aria-describedby":"Received_Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,s.bF)(Ve,{id:"Received_Amount-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(We,{name:"Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,s.k6)((a=>[(0,s.bF)(Te,{label:e.$t("Paying_Amount")},{default:(0,s.k6)((()=>[(0,s.bF)(Se,{onKeyup:t[21]||(t[21]=e=>oe.Verified_paidAmount(ie.facture.montant)),label:"Amount",placeholder:e.$t("Paying_Amount"),modelValue:ie.facture.montant,"onUpdate:modelValue":t[22]||(t[22]=e=>ie.facture.montant=e),modelModifiers:{number:!0},state:oe.getValidationState(a),"aria-describedby":"Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,s.bF)(Ve,{id:"Amount-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(xe,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.Lk)("label",null,(0,l.v_)(e.$t("Change"))+" :",1),(0,s.Lk)("p",ke,(0,l.v_)(parseFloat(ie.facture.received_amount-ie.facture.montant).toFixed(2)),1)])),_:1}),(0,s.bF)(xe,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.bF)(Te,{label:e.$t("Note")},{default:(0,s.k6)((()=>[(0,s.bF)(Ue,{id:"textarea",modelValue:ie.facture.notes,"onUpdate:modelValue":t[23]||(t[23]=e=>ie.facture.notes=e),rows:"3","max-rows":"6"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(xe,{md:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.bF)(pe,{variant:"primary",type:"submit",disabled:ie.paymentProcessing},{default:(0,s.k6)((()=>[ve,(0,s.eW)(" "+(0,l.v_)(e.$t("submit")),1)])),_:1},8,["disabled"]),t[24]||((0,s.Vq)(-1),t[24]=ie.paymentProcessing?((0,s.uX)(),(0,s.CE)("div",Pe,Fe)):(0,s.Q3)("",!0),(0,s.Vq)(1),t[24])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["title"])])),_:1},512)])}var we=a(95353),Ce=a(5947),Se=a.n(Ce),Te=a(44323);a(13246);const xe={metaInfo:{title:"Purchases"},data(){return{paymentProcessing:!1,isLoading:!0,serverParams:{sort:{field:"id",type:"desc"},page:1,perPage:10},selectedIds:[],search:"",totalRows:"",showDropdown:!1,EditPaiementMode:!1,Filter_Supplier:"",Filter_status:"",Filter_Payment:"",Filter_warehouse:"",Filter_Ref:"",Filter_date:"",Purchase_id:"",suppliers:[],warehouses:[],details:[],purchases:[],purchase:{},factures:[],purchase_due:"",due:0,facture:{montant:"",received_amount:"",Reglement:"",notes:""},limit:"10",email:{to:"",subject:"",message:"",client_name:"",purchase_Ref:""},emailPayment:{id:"",to:"",subject:"",message:"",client_name:"",Ref:""}}},mounted(){this.$root.$on("bv::dropdown::show",(e=>{this.showDropdown=!0})),this.$root.$on("bv::dropdown::hide",(e=>{this.showDropdown=!1}))},computed:{...(0,we.L8)(["currentUserPermissions","currentUser"]),columns(){return[{label:this.$t("date"),field:"date",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Reference"),field:"Ref",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Supplier"),field:"provider_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("warehouse"),field:"warehouse_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Status"),field:"statut",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Total"),field:"GrandTotal",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Paid"),field:"paid_amount",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Due"),field:"due",tdClass:"text-left",thClass:"text-left"},{label:this.$t("PaymentStatus"),field:"payment_status",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Action"),field:"actions",html:!0,tdClass:"text-right",thClass:"text-right",sortable:!1}]}},methods:{updateParams(e){this.serverParams=Object.assign({},this.serverParams,e)},onPageChange({currentPage:e}){this.serverParams.page!==e&&(this.updateParams({page:e}),this.Get_Purchases(e))},onPerPageChange({currentPerPage:e}){this.limit!==e&&(this.limit=e,this.updateParams({page:1,perPage:e}),this.Get_Purchases(1))},selectionChanged({selectedRows:e}){this.selectedIds=[],e.forEach(((e,t)=>{this.selectedIds.push(e.id)}))},onSortChange(e){let t="";t="provider_name"==e[0].field?"provider_id":"warehouse_name"==e[0].field?"warehouse_id":e[0].field,this.updateParams({sort:{type:e[0].type,field:t}}),this.Get_Purchases(this.serverParams.page)},onSearch(e){this.search=e.searchTerm,this.Get_Purchases(this.serverParams.page)},Submit_Payment(){this.$refs.Add_payment.validate().then((e=>{e&&(this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.received_amount=0):this.facture.montant>this.due?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0):this.EditPaiementMode?this.Update_Payment():this.Create_Payment())}))},Verified_paidAmount(){isNaN(this.facture.montant)?this.facture.montant=0:this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.montant=0):this.facture.montant>this.due&&(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0)},Verified_Received_Amount(){isNaN(this.facture.received_amount)&&(this.facture.received_amount=0)},getValidationState({dirty:e,validated:t,valid:a=null}){return e||t?a:null},makeToast(e,t,a){this.$root.$bvToast.toast(t,{title:a,variant:e,solid:!0})},Reset_Filter(){this.search="",this.Filter_Supplier="",this.Filter_status="",this.Filter_Payment="",this.Filter_Ref="",this.Filter_date="",this.Filter_warehouse="",this.Get_Purchases(this.serverParams.page)},Purchase_PDF(){var e=this;let t=new Te["default"]("p","pt"),a=[{title:"Ref",dataKey:"Ref"},{title:"Provider",dataKey:"provider_name"},{title:"Warehouse",dataKey:"warehouse_name"},{title:"Status",dataKey:"statut"},{title:"Total",dataKey:"GrandTotal"},{title:"Paid",dataKey:"paid_amount"},{title:"Due",dataKey:"due"},{title:"Status Payment",dataKey:"payment_status"}];t.autoTable(a,e.purchases),t.text("Purchase List",40,25),t.save("Purchase_List.pdf")},Invoice_PDF(e,t){Se().start(),Se().set(.1),axios.get("purchase_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","Purchase-"+e.Ref+".pdf"),document.body.appendChild(s),s.click(),setTimeout((()=>Se().done()),500)})).catch((()=>{setTimeout((()=>Se().done()),500)}))},Payment_Purchase_PDF(e,t){Se().start(),Se().set(.1),axios.get("payment_purchase_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","Payment-"+e.Ref+".pdf"),document.body.appendChild(s),s.click(),setTimeout((()=>Se().done()),500)})).catch((()=>{setTimeout((()=>Se().done()),500)}))},setToStrings(){null===this.Filter_Supplier?this.Filter_Supplier="":null===this.Filter_warehouse?this.Filter_warehouse="":null===this.Filter_status?this.Filter_status="":null===this.Filter_Payment&&(this.Filter_Payment="")},Get_Purchases(e){Se().start(),Se().set(.1),this.setToStrings(),axios.get("purchases?page="+e+"&Ref="+this.Filter_Ref+"&date="+this.Filter_date+"&provider_id="+this.Filter_Supplier+"&statut="+this.Filter_status+"&warehouse_id="+this.Filter_warehouse+"&payment_statut="+this.Filter_Payment+"&SortField="+this.serverParams.sort.field+"&SortType="+this.serverParams.sort.type+"&search="+this.search+"&limit="+this.limit).then((e=>{this.purchases=e.data.purchases,this.suppliers=e.data.suppliers,this.warehouses=e.data.warehouses,this.totalRows=e.data.totalRows,Se().done(),this.isLoading=!1})).catch((e=>{Se().done(),this.isLoading=!1}))},formatNumber(e,t){const a=("string"===typeof e?e:e.toString()).split(".");if(t<=0)return a[0];let s=a[1]||"";if(s.length>t)return`${a[0]}.${s.substr(0,t)}`;while(s.length<t)s+="0";return`${a[0]}.${s}`},Remove_Purchase(e,t){"yes"==t?this.makeToast("danger",this.$t("Return_exist_for_the_Transaction"),this.$t("Failed")):this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(Se().start(),Se().set(.1),axios.delete("purchases/"+e).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.PurchaseDeleted"),"success"),Fire.$emit("Delete_Purchase")})).catch((()=>{setTimeout((()=>Se().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},delete_by_selected(){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((e=>{e.value&&(Se().start(),Se().set(.1),axios.post("purchases_delete_by_selection",{selectedIds:this.selectedIds}).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.PurchaseDeleted"),"success"),Fire.$emit("Delete_Purchase")})).catch((()=>{setTimeout((()=>Se().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},Payment_Purchase_SMS(e){Se().start(),Se().set(.1),axios.post("payment_purchase_send_sms",{id:e}).then((e=>{setTimeout((()=>Se().done()),500),this.makeToast("success",this.$t("Send_SMS"),this.$t("Success"))})).catch((e=>{setTimeout((()=>Se().done()),500),this.makeToast("danger",this.$t("sms_config_invalid"),this.$t("Failed"))}))},Send_Email_Payment(e){Se().start(),Se().set(.1),axios.post("payment_purchase_send_email",{id:e}).then((e=>{setTimeout((()=>Se().done()),500),this.makeToast("success",this.$t("Send.TitleEmail"),this.$t("Success"))})).catch((e=>{setTimeout((()=>Se().done()),500),this.makeToast("danger",this.$t("SMTPIncorrect"),this.$t("Failed"))}))},Send_Email(e){Se().start(),Se().set(.1),axios.post("purchase_send_email",{id:e}).then((e=>{setTimeout((()=>Se().done()),500),this.makeToast("success",this.$t("Send.TitleEmail"),this.$t("Success"))})).catch((e=>{setTimeout((()=>Se().done()),500),this.makeToast("danger",this.$t("SMTPIncorrect"),this.$t("Failed"))}))},Purchase_SMS(e){Se().start(),Se().set(.1),axios.post("purchase_send_sms",{id:e}).then((e=>{setTimeout((()=>Se().done()),500),this.makeToast("success",this.$t("Send_SMS"),this.$t("Success"))})).catch((e=>{setTimeout((()=>Se().done()),500),this.makeToast("danger",this.$t("sms_config_invalid"),this.$t("Failed"))}))},New_Payment(e){"paid"==e.payment_status?this.makeToast("warning",this.$t("PaymentComplete"),this.$t("Warning")):(Se().start(),Se().set(.1),this.reset_form_payment(),this.EditPaiementMode=!1,this.purchase=e,this.facture.date=(new Date).toISOString().slice(0,10),this.Number_Order_Payment(),this.facture.montant=e.due,this.facture.Reglement="Cash",this.facture.received_amount=e.due,this.due=parseFloat(this.purchase.due),setTimeout((()=>{Se().done(),this.$bvModal.show("Add_Payment")}),500))},Number_Order_Payment(){axios.get("payment_purchase_get_number").then((({data:e})=>this.facture.Ref=e))},Edit_Payment(e){Se().start(),Se().set(.1),this.reset_form_payment(),this.facture.id=e.id,this.facture.Ref=e.Ref,this.facture.Reglement=e.Reglement,this.facture.date=e.date,this.facture.change=e.change,this.facture.montant=e.montant,this.facture.received_amount=parseFloat(e.montant+e.change).toFixed(2),this.facture.notes=e.notes,this.due=parseFloat(this.purchase_due)+e.montant,this.EditPaiementMode=!0,setTimeout((()=>{Se().done(),this.$bvModal.show("Add_Payment")}),500)},Show_Payments(e,t){Se().start(),Se().set(.1),this.reset_form_payment(),this.Purchase_id=e,this.purchase=t,this.Get_Payments(e)},reset_form_payment(){this.facture={id:"",purchase_id:"",date:"",Ref:"",montant:"",received_amount:"",Reglement:"",notes:""}},Create_Payment(){this.paymentProcessing=!0,Se().start(),Se().set(.1),axios.post("payment_purchase",{purchase_id:this.purchase.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),Reglement:this.facture.Reglement,change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Create_Facture_purchase"),this.makeToast("success",this.$t("Create.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,Se().done()}))},Update_Payment(){this.paymentProcessing=!0,Se().start(),Se().set(.1),axios.put("payment_purchase/"+this.facture.id,{purchase_id:this.purchase.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),Reglement:this.facture.Reglement,change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Update_Facture_purchase"),this.makeToast("success",this.$t("Update.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,Se().done()}))},Remove_Payment(e){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(Se().start(),Se().set(.1),axios.delete("payment_purchase/"+e).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.PaymentDeleted"),"success"),Fire.$emit("Delete_Facture_purchase")})).catch((()=>{setTimeout((()=>Se().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},Get_Payments(e){axios.get("get_payments_by_purchase/"+e).then((e=>{this.factures=e.data.payments,this.purchase_due=e.data.due,setTimeout((()=>{Se().done(),this.$bvModal.show("Show_payment")}),500)})).catch((()=>{setTimeout((()=>Se().done()),500)}))}},created:function(){this.Get_Purchases(1),Fire.$on("Delete_Purchase",(()=>{setTimeout((()=>{this.Get_Purchases(this.serverParams.page),Se().done()}),800)})),Fire.$on("Create_Facture_purchase",(()=>{setTimeout((()=>{this.Get_Purchases(this.serverParams.page),Se().done(),this.$bvModal.hide("Add_Payment")}),800)})),Fire.$on("Update_Facture_purchase",(()=>{setTimeout((()=>{Se().done(),this.$bvModal.hide("Add_Payment"),this.$bvModal.hide("Show_payment"),this.Get_Purchases(this.serverParams.page)}),800)})),Fire.$on("Delete_Facture_purchase",(()=>{setTimeout((()=>{Se().done(),this.$bvModal.hide("Show_payment"),this.Get_Purchases(this.serverParams.page)}),800)}))}};var Re=a(66262);const Le=(0,Re.A)(xe,[["render",$e]]),De=Le}}]);
//# sourceMappingURL=index_purchases.b8a923e9.js.map