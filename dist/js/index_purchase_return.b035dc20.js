"use strict";(self["webpackChunk"]=self["webpackChunk"]||[]).push([[1690],{29153:(e,t,a)=>{a.r(t),a.d(t,{default:()=>fe});var s=a(20641),l=a(90033),r=a(53751);const n={class:"main-content"},i={key:0,class:"loading_page spinner spinner-primary mr-3"},o={key:1},u={slot:"selected-row-actions"},d={slot:"table-actions",class:"mt-2 mb-3"},c=(0,s.Lk)("i",{class:"i-Filter-2"},null,-1),h=(0,s.Lk)("i",{class:"i-File-Copy"},null,-1),m=(0,s.Lk)("i",{class:"i-File-Excel"},null,-1),p={slot:"table-row","slot-scope":"props"},_={key:0},b=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),f=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),g=(0,s.Lk)("span",{class:"_dot _r_block-dot bg-dark"},null,-1),v=(0,s.Lk)("i",{class:"nav-icon i-Eye font-weight-bold mr-2"},null,-1),k=(0,s.Lk)("i",{class:"nav-icon i-Pen-2 font-weight-bold mr-2"},null,-1),y=(0,s.Lk)("i",{class:"nav-icon i-Money-Bag font-weight-bold mr-2"},null,-1),F=(0,s.Lk)("i",{class:"nav-icon i-Add font-weight-bold mr-2"},null,-1),P=(0,s.Lk)("i",{class:"nav-icon i-File-TXT font-weight-bold mr-2"},null,-1),$=(0,s.Lk)("i",{class:"nav-icon i-Close-Window font-weight-bold mr-2"},null,-1),w={key:1},C={key:0,class:"badge badge-outline-success"},R={key:1,class:"badge badge-outline-info"},x={key:2},T={key:0,class:"badge badge-outline-success"},L={key:1,class:"badge badge-outline-primary"},S={key:2,class:"badge badge-outline-warning"},D={key:3},V={class:"ul-btn__text ml-1"},E={key:4},U={class:"ul-btn__text ml-1"},A={class:"px-3 py-2"},W=(0,s.Lk)("i",{class:"i-Filter-2"},null,-1),B=(0,s.Lk)("i",{class:"i-Power-2"},null,-1),X={class:"table-responsive"},O={class:"table table-hover table-bordered table-md"},G={scope:"col"},M={scope:"col"},N={scope:"col"},K={scope:"col"},I={scope:"col"},Q={key:0},q={colspan:"5"},z={role:"group","aria-label":"Basic example",class:"btn-group"},j=["onClick"],Y=(0,s.Lk)("i",{class:"i-Billing"},null,-1),H=[Y],J=["onClick"],Z=(0,s.Lk)("i",{class:"i-Pen-2"},null,-1),ee=[Z],te=["onClick"],ae=(0,s.Lk)("i",{class:"i-Close"},null,-1),se=[ae],le={class:"change_amount"},re=(0,s.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),ne={key:0,class:"typo__p"},ie=(0,s.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),oe=[ie];function ue(e,t,a,Y,Z,ae){const ie=(0,s.g2)("breadcumb"),ue=(0,s.g2)("b-button"),de=(0,s.g2)("vue-excel-xlsx"),ce=(0,s.g2)("b-dropdown-item"),he=(0,s.g2)("b-navbar-nav"),me=(0,s.g2)("b-dropdown"),pe=(0,s.g2)("router-link"),_e=(0,s.g2)("vue-good-table"),be=(0,s.g2)("b-form-input"),fe=(0,s.g2)("b-form-group"),ge=(0,s.g2)("b-col"),ve=(0,s.g2)("v-select"),ke=(0,s.g2)("b-row"),ye=(0,s.g2)("b-sidebar"),Fe=(0,s.g2)("b-modal"),Pe=(0,s.g2)("b-form-invalid-feedback"),$e=(0,s.g2)("validation-provider"),we=(0,s.g2)("b-form-textarea"),Ce=(0,s.g2)("b-form"),Re=(0,s.g2)("validation-observer"),xe=(0,s.gN)("b-toggle");return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(ie,{page:e.$t("PurchasesReturn"),folder:e.$t("ListReturns")},null,8,["page","folder"]),Z.isLoading?((0,s.uX)(),(0,s.CE)("div",i)):((0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(_e,{mode:"remote",columns:ae.columns,totalRows:Z.totalRows,rows:Z.purchase_returns,onOnPageChange:ae.onPageChange,onOnPerPageChange:ae.onPerPageChange,onOnSortChange:ae.onSortChange,onOnSearch:ae.onSearch,"search-options":{placeholder:e.$t("Search_this_table"),enabled:!0},"select-options":{enabled:!0,clearSelectionText:""},onOnSelectedRowsChange:ae.selectionChanged,"pagination-options":{enabled:!0,mode:"records",nextLabel:"next",prevLabel:"prev"},styleClass:Z.showDropdown?"tableOne table-hover vgt-table full-height":"tableOne table-hover vgt-table non-height"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",u,[(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t[0]||(t[0]=e=>ae.delete_by_selected())},(0,l.v_)(e.$t("Del")),1)]),(0,s.Lk)("div",d,[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(ue,{variant:"outline-info ripple m-1",size:"sm"},{default:(0,s.k6)((()=>[c,(0,s.eW)(" "+(0,l.v_)(e.$t("Filter")),1)])),_:1})),[[xe,void 0,void 0,{"sidebar-right":!0}]]),(0,s.bF)(ue,{onClick:t[1]||(t[1]=e=>ae.Returns_Purchase_PDF()),size:"sm",variant:"outline-success ripple m-1"},{default:(0,s.k6)((()=>[h,(0,s.eW)(" PDF ")])),_:1}),(0,s.bF)(de,{class:"btn btn-sm btn-outline-danger ripple m-1",data:Z.purchase_returns,columns:ae.columns,"file-name":"purchase_returns","file-type":"xlsx","sheet-name":"purchase_returns"},{default:(0,s.k6)((()=>[m,(0,s.eW)(" EXCEL ")])),_:1},8,["data","columns"])]),(0,s.Lk)("template",p,["actions"==e.props.column.field?((0,s.uX)(),(0,s.CE)("span",_,[(0,s.Lk)("div",null,[(0,s.bF)(me,{id:"dropdown-left",variant:"link",text:"Left align","toggle-class":"text-decoration-none",size:"lg","no-caret":""},{"button-content":(0,s.k6)((()=>[b,f,g])),default:(0,s.k6)((()=>[(0,s.bF)(he,null,{default:(0,s.k6)((()=>[(0,s.bF)(ce,{title:"Show",to:"/app/purchase_return/detail/"+e.props.row.id},{default:(0,s.k6)((()=>[v,(0,s.eW)(" "+(0,l.v_)(e.$t("ReturnDetail")),1)])),_:1},8,["to"])])),_:1}),e.currentUserPermissions.includes("Purchase_Returns_edit")?((0,s.uX)(),(0,s.Wv)(ce,{key:0,title:"Edit",to:"/app/purchase_return/edit/"+e.props.row.id+"/"+e.props.row.purchase_id},{default:(0,s.k6)((()=>[k,(0,s.eW)(" "+(0,l.v_)(e.$t("EditReturn")),1)])),_:1},8,["to"])):(0,s.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_view")?((0,s.uX)(),(0,s.Wv)(ce,{key:1,onClick:t[2]||(t[2]=t=>ae.Show_Payments(e.props.row.id,e.props.row))},{default:(0,s.k6)((()=>[y,(0,s.eW)(" "+(0,l.v_)(e.$t("ShowPayment")),1)])),_:1})):(0,s.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_add")?((0,s.uX)(),(0,s.Wv)(ce,{key:2,onClick:t[3]||(t[3]=t=>ae.New_Payment(e.props.row))},{default:(0,s.k6)((()=>[F,(0,s.eW)(" "+(0,l.v_)(e.$t("AddPayment")),1)])),_:1})):(0,s.Q3)("",!0),(0,s.bF)(ce,{title:"PDF",onClick:t[4]||(t[4]=t=>ae.Return_PDF(e.props.row,e.props.row.id))},{default:(0,s.k6)((()=>[P,(0,s.eW)(" "+(0,l.v_)(e.$t("DownloadPdf")),1)])),_:1}),e.currentUserPermissions.includes("Purchase_Returns_delete")?((0,s.uX)(),(0,s.Wv)(ce,{key:3,title:"Delete",onClick:t[5]||(t[5]=t=>ae.Remove_Return(e.props.row.id))},{default:(0,s.k6)((()=>[$,(0,s.eW)(" "+(0,l.v_)(e.$t("DeleteReturn")),1)])),_:1})):(0,s.Q3)("",!0)])),_:1})])])):"statut"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",w,["completed"==e.props.row.statut?((0,s.uX)(),(0,s.CE)("span",C,(0,l.v_)(e.$t("complete")),1)):((0,s.uX)(),(0,s.CE)("span",R,(0,l.v_)(e.$t("Pending")),1))])):"payment_status"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",x,["paid"==e.props.row.payment_status?((0,s.uX)(),(0,s.CE)("span",T,(0,l.v_)(e.$t("Paid")),1)):"partial"==e.props.row.payment_status?((0,s.uX)(),(0,s.CE)("span",L,(0,l.v_)(e.$t("partial")),1)):((0,s.uX)(),(0,s.CE)("span",S,(0,l.v_)(e.$t("Unpaid")),1))])):"Ref"==e.props.column.field?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.bF)(pe,{to:"/app/purchase_return/detail/"+e.props.row.id},{default:(0,s.k6)((()=>[(0,s.Lk)("span",V,(0,l.v_)(e.props.row.Ref),1)])),_:1},8,["to"])])):"purchase_ref"==e.props.column.field&&e.props.row.purchase_id?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.bF)(pe,{to:"/app/purchases/detail/"+e.props.row.purchase_id},{default:(0,s.k6)((()=>[(0,s.Lk)("span",U,(0,l.v_)(e.props.row.purchase_ref),1)])),_:1},8,["to"])])):(0,s.Q3)("",!0)])])),_:1},8,["columns","totalRows","rows","onOnPageChange","onOnPerPageChange","onOnSortChange","onOnSearch","search-options","onOnSelectedRowsChange","styleClass"])])),(0,s.bF)(ye,{id:"sidebar-right",title:e.$t("Filter"),"bg-variant":"white",right:"",shadow:""},{default:(0,s.k6)((()=>[(0,s.Lk)("div",A,[(0,s.bF)(ke,null,{default:(0,s.k6)((()=>[(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("date")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{type:"date",modelValue:Z.Filter_date,"onUpdate:modelValue":t[6]||(t[6]=e=>Z.Filter_date=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Reference")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{label:"Reference",placeholder:e.$t("Reference"),modelValue:Z.Filter_Ref,"onUpdate:modelValue":t[7]||(t[7]=e=>Z.Filter_Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Purchase")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{reduce:e=>e.value,placeholder:e.$t("Choose_Purchase_Ref"),modelValue:Z.Filter_purchase,"onUpdate:modelValue":t[8]||(t[8]=e=>Z.Filter_purchase=e),options:Z.purchases.map((e=>({label:e.Ref,value:e.id})))},null,8,["reduce","placeholder","modelValue","options"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Supplier")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{reduce:e=>e.value,placeholder:e.$t("Choose_Supplier"),modelValue:Z.Filter_Supplier,"onUpdate:modelValue":t[9]||(t[9]=e=>Z.Filter_Supplier=e),options:Z.suppliers.map((e=>({label:e.name,value:e.id})))},null,8,["reduce","placeholder","modelValue","options"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("warehouse")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{modelValue:Z.Filter_warehouse,"onUpdate:modelValue":t[10]||(t[10]=e=>Z.Filter_warehouse=e),reduce:e=>e.value,placeholder:e.$t("Choose_Warehouse"),options:Z.warehouses.map((e=>({label:e.name,value:e.id})))},null,8,["modelValue","reduce","placeholder","options"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Status")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{modelValue:Z.Filter_status,"onUpdate:modelValue":t[11]||(t[11]=e=>Z.Filter_status=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"completed",value:"completed"},{label:"Pending",value:"pending"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("PaymentStatus")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{modelValue:Z.Filter_Payment,"onUpdate:modelValue":t[12]||(t[12]=e=>Z.Filter_Payment=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"Paid",value:"paid"},{label:"partial",value:"partial"},{label:"UnPaid",value:"unpaid"}]},null,8,["modelValue","reduce","placeholder"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"6",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(ue,{onClick:t[13]||(t[13]=e=>ae.Get_purchase_returns(Z.serverParams.page)),variant:"primary ripple m-1",size:"sm"},{default:(0,s.k6)((()=>[W,(0,s.eW)(" "+(0,l.v_)(e.$t("Filter")),1)])),_:1})])),_:1}),(0,s.bF)(ge,{md:"6",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(ue,{onClick:t[14]||(t[14]=e=>ae.Reset_Filter()),variant:"danger ripple m-1",size:"sm"},{default:(0,s.k6)((()=>[B,(0,s.eW)(" "+(0,l.v_)(e.$t("Reset")),1)])),_:1})])),_:1})])),_:1})])])),_:1},8,["title"]),(0,s.bF)(Fe,{"hide-footer":"",size:"lg",id:"Show_payment",title:e.$t("ShowPayment")},{default:(0,s.k6)((()=>[(0,s.bF)(ke,null,{default:(0,s.k6)((()=>[(0,s.bF)(ge,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",X,[(0,s.Lk)("table",O,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",G,(0,l.v_)(e.$t("date")),1),(0,s.Lk)("th",M,(0,l.v_)(e.$t("Reference")),1),(0,s.Lk)("th",N,(0,l.v_)(e.$t("Amount")),1),(0,s.Lk)("th",K,(0,l.v_)(e.$t("PayeBy")),1),(0,s.Lk)("th",I,(0,l.v_)(e.$t("Action")),1)])]),(0,s.Lk)("tbody",null,[Z.factures.length<=0?((0,s.uX)(),(0,s.CE)("tr",Q,[(0,s.Lk)("td",q,(0,l.v_)(e.$t("NodataAvailable")),1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.factures,(t=>((0,s.uX)(),(0,s.CE)("tr",null,[(0,s.Lk)("td",null,(0,l.v_)(t.date),1),(0,s.Lk)("td",null,(0,l.v_)(t.Ref),1),(0,s.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(ae.formatNumber(t.montant,2)),1),(0,s.Lk)("td",null,(0,l.v_)(t.Reglement),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",z,[(0,s.Lk)("span",{title:"Print",class:"btn btn-icon btn-info btn-sm",onClick:e=>ae.Payment_Return_PDF(t,t.id)},H,8,j),e.currentUserPermissions.includes("payment_returns_edit")?((0,s.uX)(),(0,s.CE)("span",{key:0,title:"Edit",class:"btn btn-icon btn-success btn-sm",onClick:e=>ae.Edit_Payment(t)},ee,8,J)):(0,s.Q3)("",!0),e.currentUserPermissions.includes("payment_returns_delete")?((0,s.uX)(),(0,s.CE)("span",{key:1,title:"Delete",class:"btn btn-icon btn-danger btn-sm",onClick:e=>ae.Remove_Payment(t.id)},se,8,te)):(0,s.Q3)("",!0)])])])))),256))])])])])),_:1})])),_:1})])),_:1},8,["title"]),(0,s.bF)(Re,{ref:"Add_payment"},{default:(0,s.k6)((()=>[(0,s.bF)(Fe,{"hide-footer":"",size:"lg",id:"Add_Payment",title:Z.EditPaiementMode?e.$t("EditPayment"):e.$t("AddPayment")},{default:(0,s.k6)((()=>[(0,s.bF)(Ce,{onSubmit:(0,r.D$)(ae.Submit_Payment,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(ke,null,{default:(0,s.k6)((()=>[(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)($e,{name:"date",rules:{required:!0}},{default:(0,s.k6)((a=>[(0,s.bF)(fe,{label:e.$t("date")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{label:"date",state:ae.getValidationState(a),"aria-describedby":"date-feedback",modelValue:Z.facture.date,"onUpdate:modelValue":t[15]||(t[15]=e=>Z.facture.date=e),type:"date"},null,8,["state","modelValue"]),(0,s.bF)(Pe,{id:"date-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Reference")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{disabled:"disabled",label:"Reference",placeholder:e.$t("Reference"),modelValue:Z.facture.Ref,"onUpdate:modelValue":t[16]||(t[16]=e=>Z.facture.Ref=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)($e,{name:"Payment choice",rules:{required:!0}},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{"slot-scope":"{ valid, errors }",label:e.$t("Paymentchoice")},{default:(0,s.k6)((()=>[(0,s.bF)(ve,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:Z.facture.Reglement,"onUpdate:modelValue":t[17]||(t[17]=e=>Z.facture.Reglement=e),onInput:e.Selected_PaymentMethod,reduce:e=>e.value,placeholder:e.$t("PleaseSelect"),options:[{label:"Cash",value:"Cash"},{label:"credit card",value:"credit card"},{label:"TPE",value:"tpe"},{label:"cheque",value:"cheque"},{label:"Western Union",value:"Western Union"},{label:"bank transfer",value:"bank transfer"},{label:"other",value:"other"}]},null,8,["class","state","modelValue","onInput","reduce","placeholder"]),(0,s.bF)(Pe,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)($e,{name:"Received Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,s.k6)((a=>[(0,s.bF)(fe,{label:e.$t("Received_Amount")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{onKeyup:t[18]||(t[18]=e=>ae.Verified_Received_Amount(Z.facture.received_amount)),label:"Received_Amount",placeholder:e.$t("Received_Amount"),modelValue:Z.facture.received_amount,"onUpdate:modelValue":t[19]||(t[19]=e=>Z.facture.received_amount=e),modelModifiers:{number:!0},state:ae.getValidationState(a),"aria-describedby":"Received_Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,s.bF)(Pe,{id:"Received_Amount-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.bF)($e,{name:"Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,s.k6)((a=>[(0,s.bF)(fe,{label:e.$t("Paying_Amount")},{default:(0,s.k6)((()=>[(0,s.bF)(be,{onKeyup:t[20]||(t[20]=e=>ae.Verified_paidAmount(Z.facture.montant)),label:"Amount",placeholder:e.$t("Paying_Amount"),modelValue:Z.facture.montant,"onUpdate:modelValue":t[21]||(t[21]=e=>Z.facture.montant=e),modelModifiers:{number:!0},state:ae.getValidationState(a),"aria-describedby":"Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,s.bF)(Pe,{id:"Amount-feedback"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,s.bF)(ge,{lg:"4",md:"12",sm:"12"},{default:(0,s.k6)((()=>[(0,s.Lk)("label",null,(0,l.v_)(e.$t("Change"))+" :",1),(0,s.Lk)("p",le,(0,l.v_)(parseFloat(Z.facture.received_amount-Z.facture.montant).toFixed(2)),1)])),_:1}),(0,s.bF)(ge,{lg:"12",md:"12",sm:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.bF)(fe,{label:e.$t("Note")},{default:(0,s.k6)((()=>[(0,s.bF)(we,{id:"textarea",modelValue:Z.facture.notes,"onUpdate:modelValue":t[22]||(t[22]=e=>Z.facture.notes=e),rows:"3","max-rows":"6"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s.bF)(ge,{md:"12",class:"mt-3"},{default:(0,s.k6)((()=>[(0,s.bF)(ue,{variant:"primary",type:"submit",disabled:Z.paymentProcessing},{default:(0,s.k6)((()=>[re,(0,s.eW)(" "+(0,l.v_)(e.$t("submit")),1)])),_:1},8,["disabled"]),t[23]||((0,s.Vq)(-1),t[23]=Z.paymentProcessing?((0,s.uX)(),(0,s.CE)("div",ne,oe)):(0,s.Q3)("",!0),(0,s.Vq)(1),t[23])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["title"])])),_:1},512)])}var de=a(95353),ce=a(5947),he=a.n(ce),me=a(44323);a(13246);const pe={metaInfo:{title:"Return Purchase"},data(){return{paymentProcessing:!1,isLoading:!0,serverParams:{sort:{field:"id",type:"desc"},page:1,perPage:10},selectedIds:[],search:"",totalRows:"",submitStatus:null,showDropdown:!1,EditPaiementMode:!1,Filter_Supplier:"",Filter_purchase:"",Filter_status:"",Filter_Payment:"",Filter_Ref:"",Filter_date:"",Filter_warehouse:"",purchase_returns:[],purchases:[],purchase_return:{},suppliers:[],warehouses:[],purchase_return_id:"",factures:[],purchase_return_due:"",due:0,limit:"10",facture:{id:"",purchase_return_id:"",date:"",Ref:"",montant:"",received_amount:"",Reglement:"",notes:""}}},mounted(){this.$root.$on("bv::dropdown::show",(e=>{this.showDropdown=!0})),this.$root.$on("bv::dropdown::hide",(e=>{this.showDropdown=!1}))},computed:{...(0,de.L8)(["currentUserPermissions","currentUser"]),columns(){return[{label:this.$t("date"),field:"date",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Reference"),field:"Ref",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Supplier"),field:"provider_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("warehouse"),field:"warehouse_name",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Purchase_Ref"),field:"purchase_ref",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Status"),field:"statut",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Total"),field:"GrandTotal",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Paid"),field:"paid_amount",tdClass:"text-left",thClass:"text-left"},{label:this.$t("Due"),field:"due",tdClass:"text-left",thClass:"text-left"},{label:this.$t("PaymentStatus"),field:"payment_status",html:!0,tdClass:"text-left",thClass:"text-left"},{label:this.$t("Action"),field:"actions",html:!0,tdClass:"text-right",thClass:"text-right",sortable:!1}]}},methods:{updateParams(e){this.serverParams=Object.assign({},this.serverParams,e)},onPageChange({currentPage:e}){this.serverParams.page!==e&&(this.updateParams({page:e}),this.Get_purchase_returns(e))},onPerPageChange({currentPerPage:e}){this.limit!==e&&(this.limit=e,this.updateParams({page:1,perPage:e}),this.Get_purchase_returns(1))},selectionChanged({selectedRows:e}){this.selectedIds=[],e.forEach(((e,t)=>{this.selectedIds.push(e.id)}))},onSortChange(e){let t="";t="provider_name"==e[0].field?"provider_id":"warehouse_name"==e[0].field?"warehouse_id":e[0].field,this.updateParams({sort:{type:e[0].type,field:t}}),this.Get_purchase_returns(this.serverParams.page)},onSearch(e){this.search=e.searchTerm,this.Get_purchase_returns(this.serverParams.page)},Submit_Payment(){this.$refs.Add_payment.validate().then((e=>{e&&(this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.received_amount=0):this.facture.montant>this.due?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0):this.EditPaiementMode?this.Update_Payment():this.Create_Payment())}))},Verified_paidAmount(){isNaN(this.facture.montant)?this.facture.montant=0:this.facture.montant>this.facture.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.facture.montant=0):this.facture.montant>this.due&&(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.facture.montant=0)},Verified_Received_Amount(){isNaN(this.facture.received_amount)&&(this.facture.received_amount=0)},getValidationState({dirty:e,validated:t,valid:a=null}){return e||t?a:null},makeToast(e,t,a){this.$root.$bvToast.toast(t,{title:a,variant:e,solid:!0})},Reset_Filter(){this.search="",this.Filter_Supplier="",this.Filter_purchase="",this.Filter_status="",this.Filter_Payment="",this.Filter_Ref="",this.Filter_date="",this.Filter_warehouse="",this.Get_purchase_returns(this.serverParams.page)},formatNumber(e,t){const a=("string"===typeof e?e:e.toString()).split(".");if(t<=0)return a[0];let s=a[1]||"";if(s.length>t)return`${a[0]}.${s.substr(0,t)}`;while(s.length<t)s+="0";return`${a[0]}.${s}`},Return_PDF(e,t){he().start(),he().set(.1),axios.get("return_purchase_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","purchase_return_"+e.Ref+".pdf"),document.body.appendChild(s),s.click(),setTimeout((()=>he().done()),500)})).catch((()=>{setTimeout((()=>he().done()),500)}))},Payment_Return_PDF(e,t){he().start(),he().set(.1),axios.get("payment_return_purchase_pdf/"+t,{responseType:"blob",headers:{"Content-Type":"application/json"}}).then((t=>{const a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","Payment-"+e.Ref+".pdf"),document.body.appendChild(s),s.click(),setTimeout((()=>he().done()),500)})).catch((()=>{setTimeout((()=>he().done()),500)}))},Returns_Purchase_PDF(){var e=this;let t=new me["default"]("p","pt"),a=[{title:"Ref",dataKey:"Ref"},{title:"Provider",dataKey:"provider_name"},{title:"Warehouse",dataKey:"warehouse_name"},{title:"Purchase",dataKey:"purchase_ref"},{title:"Status",dataKey:"statut"},{title:"Total",dataKey:"GrandTotal"},{title:"Paid",dataKey:"paid_amount"},{title:"Due",dataKey:"due"},{title:"Status Payment",dataKey:"payment_status"}];t.autoTable(a,e.purchase_returns),t.text("Purchase Returns",40,25),t.save("purchase_returns.pdf")},Number_Order_Payment(){axios.get("payment/returns_purchase/Number/Order").then((({data:e})=>this.facture.Ref=e))},New_Payment(e){"paid"==e.payment_status?this.$swal({icon:"error",title:"Oops...",text:this.$t("PaymentComplete")}):(he().start(),he().set(.1),this.reset_form_payment(),this.EditPaiementMode=!1,this.purchase_return=e,this.facture.date=(new Date).toISOString().slice(0,10),this.Number_Order_Payment(),this.facture.montant=e.due,this.facture.Reglement="Cash",this.facture.received_amount=e.due,this.due=parseFloat(this.purchase_return.due),setTimeout((()=>{he().done(),this.$bvModal.show("Add_Payment")}),500))},reset_form_payment(){this.due=0,this.facture={id:"",purchase_return_id:"",date:"",Ref:"",montant:"",received_amount:"",Reglement:"",notes:""}},Edit_Payment(e){he().start(),he().set(.1),this.reset_form_payment(),this.EditPaiementMode=!0,this.facture.id=e.id,this.facture.Ref=e.Ref,this.facture.Reglement=e.Reglement,this.facture.date=e.date,this.facture.change=e.change,this.facture.montant=e.montant,this.facture.received_amount=parseFloat(e.montant+e.change).toFixed(2),this.facture.notes=e.notes,this.due=parseFloat(this.purchase_return_due)+e.montant,setTimeout((()=>{he().done(),this.$bvModal.show("Add_Payment")}),1e3)},Show_Payments(e,t){he().start(),he().set(.1),this.reset_form_payment(),this.purchase_return_id=e,this.purchase_return=t,this.Get_Payments(e)},Get_Payments(e){axios.get("returns/purchase/payment/"+e).then((e=>{this.factures=e.data.payments,this.purchase_return_due=e.data.due,setTimeout((()=>{he().done(),this.$bvModal.show("Show_payment")}),500)})).catch((()=>{setTimeout((()=>he().done()),500)}))},setToStrings(){null===this.Filter_Supplier?this.Filter_Supplier="":null===this.Filter_warehouse?this.Filter_warehouse="":null===this.Filter_status?this.Filter_status="":null===this.Filter_Payment?this.Filter_Payment="":null===this.Filter_purchase&&(this.Filter_purchase="")},Get_purchase_returns(e){he().start(),he().set(.1),this.setToStrings(),axios.get("returns/purchase?page="+e+"&Ref="+this.Filter_Ref+"&date="+this.Filter_date+"&purchase_id="+this.Filter_purchase+"&provider_id="+this.Filter_Supplier+"&statut="+this.Filter_status+"&warehouse_id="+this.Filter_warehouse+"&payment_statut="+this.Filter_Payment+"&SortField="+this.serverParams.sort.field+"&SortType="+this.serverParams.sort.type+"&search="+this.search+"&limit="+this.limit).then((e=>{this.purchase_returns=e.data.purchase_returns,this.suppliers=e.data.suppliers,this.purchases=e.data.purchases,this.warehouses=e.data.warehouses,this.totalRows=e.data.totalRows,he().done(),this.isLoading=!1})).catch((e=>{he().done(),setTimeout((()=>{this.isLoading=!1}),500)}))},Remove_Return(e){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(he().start(),he().set(.1),axios.delete("returns/purchase/"+e).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.ReturnDeleted"),"success"),Fire.$emit("Delete_purchase_return")})).catch((()=>{setTimeout((()=>he().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},delete_by_selected(){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((e=>{e.value&&(he().start(),he().set(.1),axios.post("returns/purchase/delete/by_selection",{selectedIds:this.selectedIds}).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.ReturnDeleted"),"success"),Fire.$emit("Delete_purchase_return")})).catch((()=>{setTimeout((()=>he().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))},Create_Payment(){this.paymentProcessing=!0,he().start(),he().set(.1),axios.post("payment/returns_purchase",{purchase_return_id:this.purchase_return.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),Reglement:this.facture.Reglement,notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Create_payment_purchase_return"),this.makeToast("success",this.$t("Create.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,he().done()}))},Update_Payment(){this.paymentProcessing=!0,he().start(),he().set(.1),axios.put("payment/returns_purchase/"+this.facture.id,{purchase_return_id:this.purchase_return.id,date:this.facture.date,montant:parseFloat(this.facture.montant).toFixed(2),received_amount:parseFloat(this.facture.received_amount).toFixed(2),change:parseFloat(this.facture.received_amount-this.facture.montant).toFixed(2),Reglement:this.facture.Reglement,notes:this.facture.notes}).then((e=>{this.paymentProcessing=!1,Fire.$emit("Update_payment_purchase_return"),this.makeToast("success",this.$t("Update.TitlePayment"),this.$t("Success"))})).catch((e=>{this.paymentProcessing=!1,he().done()}))},Remove_Payment(e){this.$swal({title:this.$t("Delete.Title"),text:this.$t("Delete.Text"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:this.$t("Delete.cancelButtonText"),confirmButtonText:this.$t("Delete.confirmButtonText")}).then((t=>{t.value&&(he().start(),he().set(.1),axios.delete("payment/returns_purchase/"+e).then((()=>{this.$swal(this.$t("Delete.Deleted"),this.$t("Delete.PaymentDeleted")),Fire.$emit("Delete_payment_purchase_return")})).catch((()=>{setTimeout((()=>he().done()),500),this.$swal(this.$t("Delete.Failed"),this.$t("Delete.Therewassomethingwronge"),"warning")})))}))}},created(){this.Get_purchase_returns(1),Fire.$on("Create_payment_purchase_return",(()=>{setTimeout((()=>{this.Get_purchase_returns(this.serverParams.page),he().done(),this.$bvModal.hide("Add_Payment")}),800)})),Fire.$on("Update_payment_purchase_return",(()=>{setTimeout((()=>{this.Get_purchase_returns(this.serverParams.page),he().done(),this.$bvModal.hide("Add_Payment"),this.$bvModal.hide("Show_payment")}),800)})),Fire.$on("Delete_payment_purchase_return",(()=>{setTimeout((()=>{this.Get_purchase_returns(this.serverParams.page),he().done(),this.$bvModal.hide("Show_payment")}),800)})),Fire.$on("Delete_purchase_return",(()=>{setTimeout((()=>{this.Get_purchase_returns(this.serverParams.page),he().done()}),800)}))}};var _e=a(66262);const be=(0,_e.A)(pe,[["render",ue]]),fe=be}}]);
//# sourceMappingURL=index_purchase_return.b035dc20.js.map