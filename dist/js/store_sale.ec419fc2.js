"use strict";(self["webpackChunk"]=self["webpackChunk"]||[]).push([[7384],{37427:(e,t,a)=>{a.d(t,{c:()=>p});var i="https://js.stripe.com/v3",s=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,l="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",d=function(){for(var e=document.querySelectorAll('script[src^="'.concat(i,'"]')),t=0;t<e.length;t++){var a=e[t];if(s.test(a.src))return a}return null},r=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(i).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(a),a},n=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.54.2",startTime:t})},o=null,u=function(e){return null!==o||(o=new Promise((function(t,a){if("undefined"!==typeof window&&"undefined"!==typeof document)if(window.Stripe&&e&&console.warn(l),window.Stripe)t(window.Stripe);else try{var i=d();i&&e?console.warn(l):i||(i=r(e)),i.addEventListener("load",(function(){window.Stripe?t(window.Stripe):a(new Error("Stripe.js not available"))})),i.addEventListener("error",(function(){a(new Error("Failed to load Stripe.js"))}))}catch(s){return void a(s)}else t(null)}))),o},c=function(e,t,a){if(null===e)return null;var i=e.apply(void 0,t);return n(i,a),i},h=Promise.resolve().then((function(){return u(null)})),_=!1;h["catch"]((function(e){_||console.warn(e)}));var p=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];_=!0;var i=Date.now();return h.then((function(e){return c(e,t,i)}))}},3465:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Se});var i=a(20641),s=a(53751),l=a(90033);const d={class:"main-content"},r={key:0,class:"loading_page spinner spinner-primary mr-3"},n={id:"autocomplete",class:"autocomplete"},o=["placeholder"],u={class:"autocomplete-result-list"},c=["onMousedown"],h={class:"table-responsive"},_={class:"table table-hover"},p={class:"bg-gray-300"},m=(0,i.Lk)("th",{scope:"col"},"#",-1),b={scope:"col"},k={scope:"col"},v={scope:"col"},y={scope:"col"},f={scope:"col"},g={scope:"col"},F={scope:"col"},x=(0,i.Lk)("th",{scope:"col",class:"text-center"},[(0,i.Lk)("i",{class:"i-Close-Window text-25"})],-1),S={key:0},$={colspan:"9"},w=(0,i.Lk)("br",null,null,-1),C={class:"badge badge-success"},L={key:0,class:"badge badge-warning"},P={key:1,class:"badge badge-warning"},T={class:"quantity"},V=["onClick"],U=["onKeyup","max","onUpdate:modelValue"],N=["onClick"],W=["onClick"],M=["onClick"],q={class:"offset-md-9 col-md-3 mt-4"},D={class:"table table-striped table-sm"},E={class:"bold"},A={class:"bold"},X={class:"bold"},I={class:"font-weight-bold"},Q={class:"font-weight-bold"},G={class:"change_amount"},R={key:0,class:"typo__p"},O=(0,i.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),K=[O],j={key:1},B={class:"mt-3"},Y=(0,i.Lk)("span",{class:"mr-3"},"Saved Credit Card Info For This Client ",-1),z=(0,i.Lk)("span",null,[(0,i.Lk)("i",{class:"i-Two-Windows"}),(0,i.eW)(" New Credit Card ")],-1),J={class:"table table-hover mt-3"},H=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Last 4 digits"),(0,i.Lk)("th",null,"Type"),(0,i.Lk)("th",null,"Exp"),(0,i.Lk)("th",null,"Action")])],-1),Z=(0,i.Lk)("span",null,[(0,i.Lk)("i",{class:"i-Drag-Up"}),(0,i.eW)(" Use This ")],-1),ee={key:1,class:"i-Yes",style:{"font-size":"20px"}},te={key:2},ae={id:"payment-form"},ie={for:"card-element",class:"leading-7 text-sm text-gray-600"},se=(0,i.Lk)("span",null,[(0,i.Lk)("i",{class:"i-Two-Windows"}),(0,i.eW)(" Use Saved Credit Card ")],-1),le=(0,i.Lk)("div",{id:"card-element"},null,-1),de=(0,i.Lk)("div",{id:"card-errors",class:"is-invalid",role:"alert"},null,-1),re=["placeholder"],ne=(0,i.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),oe={key:0,class:"typo__p"},ue=(0,i.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),ce=[ue],he=(0,i.Lk)("i",{class:"i-Yes me-2 font-weight-bold"},null,-1),_e={key:0,class:"typo__p"},pe=(0,i.Lk)("div",{class:"spinner sm spinner-primary mt-3"},null,-1),me=[pe];function be(e,t,a,O,ue,pe){const be=(0,i.g2)("breadcumb"),ke=(0,i.g2)("b-form-input"),ve=(0,i.g2)("b-form-invalid-feedback"),ye=(0,i.g2)("b-form-group"),fe=(0,i.g2)("validation-provider"),ge=(0,i.g2)("b-col"),Fe=(0,i.g2)("v-select"),xe=(0,i.g2)("b-input-group-prepend"),Se=(0,i.g2)("b-input-group-append"),$e=(0,i.g2)("b-input-group"),we=(0,i.g2)("b-button"),Ce=(0,i.g2)("b-card"),Le=(0,i.g2)("b-row"),Pe=(0,i.g2)("b-form"),Te=(0,i.g2)("validation-observer"),Ve=(0,i.g2)("b-modal");return(0,i.uX)(),(0,i.CE)("div",d,[(0,i.bF)(be,{page:e.$t("AddSale"),folder:e.$t("ListSales")},null,8,["page","folder"]),ue.isLoading?((0,i.uX)(),(0,i.CE)("div",r)):(0,i.Q3)("",!0),ue.isLoading?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(Te,{key:1,ref:"create_sale"},{default:(0,i.k6)((()=>[(0,i.bF)(Pe,{onSubmit:(0,s.D$)(pe.Submit_Sale,["prevent"])},{default:(0,i.k6)((()=>[(0,i.bF)(Le,null,{default:(0,i.k6)((()=>[(0,i.bF)(ge,{lg:"12",md:"12",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(Ce,null,{default:(0,i.k6)((()=>[(0,i.bF)(Le,null,{default:(0,i.k6)((()=>[(0,i.bF)(ge,{lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"date",rules:{required:!0}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("date")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{state:pe.getValidationState(a),"aria-describedby":"date-feedback",type:"date",modelValue:ue.sale.date,"onUpdate:modelValue":t[0]||(t[0]=e=>ue.sale.date=e)},null,8,["state","modelValue"]),(0,i.bF)(ve,{id:"OrderTax-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Customer",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("Customer")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:ue.sale.client_id,"onUpdate:modelValue":t[1]||(t[1]=e=>ue.sale.client_id=e),onInput:pe.Selected_customer,reduce:e=>e.value,placeholder:e.$t("Choose_Customer"),options:ue.clients.map((e=>({label:e.name,value:e.id})))},null,8,["class","state","modelValue","onInput","reduce","placeholder","options"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"warehouse",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("warehouse")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),disabled:ue.details.length>0,onInput:pe.Selected_Warehouse,modelValue:ue.sale.warehouse_id,"onUpdate:modelValue":t[2]||(t[2]=e=>ue.sale.warehouse_id=e),reduce:e=>e.value,placeholder:e.$t("Choose_Warehouse"),options:ue.warehouses.map((e=>({label:e.name,value:e.id})))},null,8,["class","state","disabled","onInput","modelValue","reduce","placeholder","options"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{md:"12",class:"mb-5"},{default:(0,i.k6)((()=>[(0,i.Lk)("h6",null,(0,l.v_)(e.$t("ProductName")),1),(0,i.Lk)("div",n,[(0,i.Lk)("input",{placeholder:e.$t("Scan_Search_Product_by_Code_Name"),onInput:t[3]||(t[3]=e=>ue.search_input=e.target.value),onKeyup:t[4]||(t[4]=e=>pe.search(ue.search_input)),onFocus:t[5]||(t[5]=(...e)=>pe.handleFocus&&pe.handleFocus(...e)),onBlur:t[6]||(t[6]=(...e)=>pe.handleBlur&&pe.handleBlur(...e)),ref:"product_autocomplete",class:"autocomplete-input"},null,40,o),(0,i.bo)((0,i.Lk)("ul",u,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ue.product_filter,(e=>((0,i.uX)(),(0,i.CE)("li",{class:"autocomplete-result",onMousedown:t=>pe.SearchProduct(e)},(0,l.v_)(pe.getResultValue(e)),41,c)))),256))],512),[[s.aG,ue.focused]])])])),_:1}),(0,i.bF)(ge,{md:"12",class:"mb-4"},{default:(0,i.k6)((()=>[(0,i.Lk)("h5",null,(0,l.v_)(e.$t("order_products"))+" *",1),(0,i.Lk)("div",h,[(0,i.Lk)("table",_,[(0,i.Lk)("thead",p,[(0,i.Lk)("tr",null,[m,(0,i.Lk)("th",b,(0,l.v_)(e.$t("ProductName")),1),(0,i.Lk)("th",k,(0,l.v_)(e.$t("Net_Unit_Price")),1),(0,i.Lk)("th",v,(0,l.v_)(e.$t("CurrentStock")),1),(0,i.Lk)("th",y,(0,l.v_)(e.$t("Qty")),1),(0,i.Lk)("th",f,(0,l.v_)(e.$t("Discount")),1),(0,i.Lk)("th",g,(0,l.v_)(e.$t("Tax")),1),(0,i.Lk)("th",F,(0,l.v_)(e.$t("SubTotal")),1),x])]),(0,i.Lk)("tbody",null,[ue.details.length<=0?((0,i.uX)(),(0,i.CE)("tr",S,[(0,i.Lk)("td",$,(0,l.v_)(e.$t("NodataAvailable")),1)])):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ue.details,(t=>((0,i.uX)(),(0,i.CE)("tr",null,[(0,i.Lk)("td",null,(0,l.v_)(t.detail_id),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",null,(0,l.v_)(t.code),1),w,(0,i.Lk)("span",C,(0,l.v_)(t.name),1)]),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(pe.formatNumber(t.Net_price,3)),1),(0,i.Lk)("td",null,["is_service"==t.product_type?((0,i.uX)(),(0,i.CE)("span",L,"----")):((0,i.uX)(),(0,i.CE)("span",P,(0,l.v_)(t.stock)+" "+(0,l.v_)(t.unitSale),1))]),(0,i.Lk)("td",null,[(0,i.Lk)("div",T,[(0,i.bF)($e,null,{default:(0,i.k6)((()=>[(0,i.bF)(xe,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",{class:"btn btn-primary btn-sm",onClick:e=>pe.decrement(t,t.detail_id)},"-",8,V)])),_:2},1024),(0,i.bo)((0,i.Lk)("input",{class:"form-control",onKeyup:e=>pe.Verified_Qty(t,t.detail_id),min:0,max:t.stock,"onUpdate:modelValue":e=>t.quantity=e},null,40,U),[[s.Jo,t.quantity,void 0,{number:!0}]]),(0,i.bF)(Se,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",{class:"btn btn-primary btn-sm",onClick:e=>pe.increment(t,t.detail_id)},"+",8,N)])),_:2},1024)])),_:2},1024)])]),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(pe.formatNumber(t.DiscountNet*t.quantity,2)),1),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(pe.formatNumber(t.taxe*t.quantity,2)),1),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(t.subtotal.toFixed(2)),1),(0,i.Lk)("td",null,[e.currentUserPermissions&&e.currentUserPermissions.includes("edit_product_sale")?((0,i.uX)(),(0,i.CE)("i",{key:0,onClick:e=>pe.Modal_Updat_Detail(t),class:"i-Edit text-25 text-success cursor-pointer"},null,8,W)):(0,i.Q3)("",!0),(0,i.Lk)("i",{onClick:e=>pe.delete_Product_Detail(t.detail_id),class:"i-Close-Window text-25 text-danger cursor-pointer"},null,8,M)])])))),256))])])])])),_:1}),(0,i.Lk)("div",q,[(0,i.Lk)("table",D,[(0,i.Lk)("tbody",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("td",E,(0,l.v_)(e.$t("OrderTax")),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(ue.sale.TaxNet.toFixed(2))+" ("+(0,l.v_)(pe.formatNumber(ue.sale.tax_rate,2))+" %)",1)])]),(0,i.Lk)("tr",null,[(0,i.Lk)("td",A,(0,l.v_)(e.$t("Discount")),1),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(ue.sale.discount.toFixed(2)),1)]),(0,i.Lk)("tr",null,[(0,i.Lk)("td",X,(0,l.v_)(e.$t("Shipping")),1),(0,i.Lk)("td",null,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(ue.sale.shipping.toFixed(2)),1)]),(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,[(0,i.Lk)("span",I,(0,l.v_)(e.$t("Total")),1)]),(0,i.Lk)("td",null,[(0,i.Lk)("span",Q,(0,l.v_)(e.currentUser.currency)+" "+(0,l.v_)(ue.GrandTotal.toFixed(2)),1)])])])])]),e.currentUserPermissions&&e.currentUserPermissions.includes("edit_tax_discount_shipping_sale")?((0,i.uX)(),(0,i.Wv)(ge,{key:0,lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Order Tax",rules:{regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("OrderTax")},{default:(0,i.k6)((()=>[(0,i.bF)($e,{append:"%"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{state:pe.getValidationState(a),"aria-describedby":"OrderTax-feedback",label:"Order Tax",modelValue:ue.sale.tax_rate,"onUpdate:modelValue":t[7]||(t[7]=e=>ue.sale.tax_rate=e),modelModifiers:{number:!0},onKeyup:t[8]||(t[8]=e=>pe.keyup_OrderTax())},null,8,["state","modelValue"])])),_:2},1024),(0,i.bF)(ve,{id:"OrderTax-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),e.currentUserPermissions&&e.currentUserPermissions.includes("edit_tax_discount_shipping_sale")?((0,i.uX)(),(0,i.Wv)(ge,{key:1,lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Discount",rules:{regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("Discount")},{default:(0,i.k6)((()=>[(0,i.bF)($e,{append:e.currentUser.currency},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{state:pe.getValidationState(a),"aria-describedby":"Discount-feedback",label:"Discount",modelValue:ue.sale.discount,"onUpdate:modelValue":t[9]||(t[9]=e=>ue.sale.discount=e),modelModifiers:{number:!0},onKeyup:t[10]||(t[10]=e=>pe.keyup_Discount())},null,8,["state","modelValue"])])),_:2},1032,["append"]),(0,i.bF)(ve,{id:"Discount-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),e.currentUserPermissions&&e.currentUserPermissions.includes("edit_tax_discount_shipping_sale")?((0,i.uX)(),(0,i.Wv)(ge,{key:2,lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Shipping",rules:{regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("Shipping")},{default:(0,i.k6)((()=>[(0,i.bF)($e,{append:e.currentUser.currency},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{state:pe.getValidationState(a),"aria-describedby":"Shipping-feedback",label:"Shipping",modelValue:ue.sale.shipping,"onUpdate:modelValue":t[11]||(t[11]=e=>ue.sale.shipping=e),modelModifiers:{number:!0},onKeyup:t[12]||(t[12]=e=>pe.keyup_Shipping())},null,8,["state","modelValue"])])),_:2},1032,["append"]),(0,i.bF)(ve,{id:"Shipping-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(ge,{lg:"4",md:"4",sm:"12",class:"mb-3"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Status",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("Status")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:ue.sale.statut,"onUpdate:modelValue":t[13]||(t[13]=e=>ue.sale.statut=e),reduce:e=>e.value,placeholder:e.$t("Choose_Status"),options:[{label:"completed",value:"completed"},{label:"Pending",value:"pending"},{label:"ordered",value:"ordered"}]},null,8,["class","state","modelValue","reduce","placeholder"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{md:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"PaymentStatus"},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{label:e.$t("PaymentStatus")},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{onInput:pe.Selected_PaymentStatus,reduce:e=>e.value,modelValue:ue.payment.status,"onUpdate:modelValue":t[14]||(t[14]=e=>ue.payment.status=e),placeholder:e.$t("Choose_Status"),options:[{label:"Paid",value:"paid"},{label:"partial",value:"partial"},{label:"Pending",value:"pending"}]},null,8,["onInput","reduce","modelValue","placeholder"])])),_:1},8,["label"])])),_:1})])),_:1}),"pending"!=ue.payment.status?((0,i.uX)(),(0,i.Wv)(ge,{key:3,md:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Payment choice",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("Paymentchoice")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),reduce:e=>e.value,onInput:pe.Selected_PaymentMethod,modelValue:ue.payment.Reglement,"onUpdate:modelValue":t[15]||(t[15]=e=>ue.payment.Reglement=e),placeholder:e.$t("PleaseSelect"),options:[{label:"Cash",value:"Cash"},{label:"credit card",value:"credit card"},{label:"TPE",value:"tpe"},{label:"cheque",value:"cheque"},{label:"Western Union",value:"Western Union"},{label:"bank transfer",value:"bank transfer"},{label:"other",value:"other"}]},null,8,["class","state","reduce","onInput","modelValue","placeholder"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),"pending"!=ue.payment.status?((0,i.uX)(),(0,i.Wv)(ge,{key:4,md:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Received Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("Received_Amount")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{onKeyup:t[16]||(t[16]=e=>pe.Verified_Received_Amount(ue.payment.received_amount)),label:"Received_Amount",placeholder:e.$t("Received_Amount"),modelValue:ue.payment.received_amount,"onUpdate:modelValue":t[17]||(t[17]=e=>ue.payment.received_amount=e),modelModifiers:{number:!0},state:pe.getValidationState(a),"aria-describedby":"Received_Amount-feedback"},null,8,["placeholder","modelValue","state"]),(0,i.bF)(ve,{id:"Received_Amount-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),"pending"!=ue.payment.status?((0,i.uX)(),(0,i.Wv)(ge,{key:5,md:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Amount",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("Paying_Amount")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{disabled:"paid"==ue.payment.status,label:"Amount",placeholder:e.$t("Paying_Amount"),modelValue:ue.payment.amount,"onUpdate:modelValue":t[18]||(t[18]=e=>ue.payment.amount=e),modelModifiers:{number:!0},onKeyup:t[19]||(t[19]=e=>pe.Verified_paidAmount(ue.payment.amount)),state:pe.getValidationState(a),"aria-describedby":"Amount-feedback"},null,8,["disabled","placeholder","modelValue","state"]),(0,i.bF)(ve,{id:"Amount-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),"pending"!=ue.payment.status?((0,i.uX)(),(0,i.Wv)(ge,{key:6,md:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("label",null,(0,l.v_)(e.$t("Change"))+" :",1),(0,i.Lk)("p",G,(0,l.v_)(parseFloat(ue.payment.received_amount-ue.payment.amount).toFixed(2)),1)])),_:1})):(0,i.Q3)("",!0),"pending"!=ue.payment.status&&"credit card"==ue.payment.Reglement?((0,i.uX)(),(0,i.Wv)(ge,{key:7,md:"12",class:"mt-3"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(Ce,null,{default:(0,i.k6)((()=>[t[20]||((0,i.Vq)(-1),t[20]=ue.submit_showing_credit_card?((0,i.uX)(),(0,i.CE)("div",R,K)):(0,i.Q3)("",!0),(0,i.Vq)(1),t[20]),pe.displaySavedPaymentMethods&&!ue.submit_showing_credit_card?((0,i.uX)(),(0,i.CE)("div",j,[(0,i.Lk)("div",B,[Y,(0,i.bF)(we,{variant:"outline-info",onClick:t[21]||(t[21]=e=>pe.show_new_credit_card())},{default:(0,i.k6)((()=>[z])),_:1})]),(0,i.Lk)("table",J,[H,(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ue.savedPaymentMethods,(e=>((0,i.uX)(),(0,i.CE)("tr",{class:(0,l.C4)({"bg-selected-card":pe.isSelectedCard(e)})},[(0,i.Lk)("td",null,"**** "+(0,l.v_)(e.last4),1),(0,i.Lk)("td",null,(0,l.v_)(e.type),1),(0,i.Lk)("td",null,(0,l.v_)(e.exp),1),(0,i.Lk)("td",null,[pe.isSelectedCard(e)||ue.card_id==e.card_id?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(we,{key:0,variant:"outline-primary",onClick:t=>pe.selectCard(e)},{default:(0,i.k6)((()=>[Z])),_:2},1032,["onClick"])),pe.isSelectedCard(e)||ue.card_id==e.card_id?((0,i.uX)(),(0,i.CE)("i",ee)):(0,i.Q3)("",!0)])],2)))),256))])])])):(0,i.Q3)("",!0),pe.displayFormNewCard&&!ue.submit_showing_credit_card?((0,i.uX)(),(0,i.CE)("div",te,[(0,i.Lk)("form",ae,[(0,i.Lk)("label",ie,[(0,i.eW)((0,l.v_)(e.$t("Credit_Card_Info"))+" ",1),ue.savedPaymentMethods&&ue.savedPaymentMethods.length>0?((0,i.uX)(),(0,i.Wv)(we,{key:0,variant:"outline-info",onClick:t[22]||(t[22]=e=>pe.show_saved_credit_card())},{default:(0,i.k6)((()=>[se])),_:1})):(0,i.Q3)("",!0)]),le,de])])):(0,i.Q3)("",!0)])),_:1},512),[[s.aG,"credit card"==ue.payment.Reglement]])])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(ge,{md:"12",class:"mt-3"},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{label:e.$t("Note")},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[23]||(t[23]=e=>ue.sale.notes=e),rows:"4",class:"form-control",placeholder:e.$t("Afewwords")},null,8,re),[[s.Jo,ue.sale.notes]])])),_:1},8,["label"])])),_:1}),(0,i.bF)(ge,{md:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(ye,null,{default:(0,i.k6)((()=>[(0,i.bF)(we,{variant:"primary",disabled:ue.paymentProcessing,onClick:pe.Submit_Sale},{default:(0,i.k6)((()=>[ne,(0,i.eW)(" "+(0,l.v_)(e.$t("submit")),1)])),_:1},8,["disabled","onClick"]),t[24]||((0,i.Vq)(-1),t[24]=ue.paymentProcessing?((0,i.uX)(),(0,i.CE)("div",oe,ce)):(0,i.Q3)("",!0),(0,i.Vq)(1),t[24])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},512)),(0,i.bF)(Te,{ref:"Update_Detail"},{default:(0,i.k6)((()=>[(0,i.bF)(Ve,{"hide-footer":"",size:"lg",id:"form_Update_Detail",title:ue.detail.name},{default:(0,i.k6)((()=>[(0,i.bF)(Pe,{onSubmit:(0,s.D$)(pe.submit_Update_Detail,["prevent"])},{default:(0,i.k6)((()=>[(0,i.bF)(Le,null,{default:(0,i.k6)((()=>[(0,i.bF)(ge,{lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Product Price",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("ProductPrice")+" *",id:"Price-input"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{label:"Product Price",modelValue:ue.detail.Unit_price,"onUpdate:modelValue":t[25]||(t[25]=e=>ue.detail.Unit_price=e),state:pe.getValidationState(a),"aria-describedby":"Price-feedback"},null,8,["modelValue","state"]),(0,i.bF)(ve,{id:"Price-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Tax Method",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("TaxMethod")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:ue.detail.tax_method,"onUpdate:modelValue":t[26]||(t[26]=e=>ue.detail.tax_method=e),reduce:e=>e.value,placeholder:e.$t("Choose_Method"),options:[{label:"Exclusive",value:"1"},{label:"Inclusive",value:"2"}]},null,8,["class","state","modelValue","reduce","placeholder"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Order Tax",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("OrderTax")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)($e,{append:"%"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{label:"Order Tax",modelValue:ue.detail.tax_percent,"onUpdate:modelValue":t[27]||(t[27]=e=>ue.detail.tax_percent=e),state:pe.getValidationState(a),"aria-describedby":"OrderTax-feedback"},null,8,["modelValue","state"])])),_:2},1024),(0,i.bF)(ve,{id:"OrderTax-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Discount Method",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("Discount_Method")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{modelValue:ue.detail.discount_Method,"onUpdate:modelValue":t[28]||(t[28]=e=>ue.detail.discount_Method=e),reduce:e=>e.value,placeholder:e.$t("Choose_Method"),class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),options:[{label:"Percent %",value:"1"},{label:"Fixed",value:"2"}]},null,8,["modelValue","reduce","placeholder","class","state"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),(0,i.bF)(ge,{lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Discount Rate",rules:{required:!0,regex:/^\d*\.?\d*$/}},{default:(0,i.k6)((a=>[(0,i.bF)(ye,{label:e.$t("Discount")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{label:"Discount",modelValue:ue.detail.discount,"onUpdate:modelValue":t[29]||(t[29]=e=>ue.detail.discount=e),modelModifiers:{number:!0},state:pe.getValidationState(a),"aria-describedby":"Discount-feedback"},null,8,["modelValue","state"]),(0,i.bF)(ve,{id:"Discount-feedback"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(a.errors[0]),1)])),_:2},1024)])),_:2},1032,["label"])])),_:1})])),_:1}),"is_service"!=ue.detail.product_type?((0,i.uX)(),(0,i.Wv)(ge,{key:0,lg:"6",md:"6",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(fe,{name:"Unit Sale",rules:{required:!0}},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{"slot-scope":"{ valid, errors }",label:e.$t("UnitSale")+" *"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe,{class:(0,l.C4)({"is-invalid":!!e.errors.length}),state:!e.errors[0]&&(!!e.valid||null),modelValue:ue.detail.sale_unit_id,"onUpdate:modelValue":t[30]||(t[30]=e=>ue.detail.sale_unit_id=e),placeholder:e.$t("Choose_Unit_Sale"),reduce:e=>e.value,options:ue.units.map((e=>({label:e.name,value:e.id})))},null,8,["class","state","modelValue","placeholder","reduce","options"]),(0,i.bF)(ve,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.errors[0]),1)])),_:1})])),_:1},8,["label"])])),_:1})])),_:1})):(0,i.Q3)("",!0),(0,i.bo)((0,i.bF)(ge,{lg:"12",md:"12",sm:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(ye,{label:e.$t("Add_product_IMEI_Serial_number")},{default:(0,i.k6)((()=>[(0,i.bF)(ke,{label:"Add_product_IMEI_Serial_number",modelValue:ue.detail.imei_number,"onUpdate:modelValue":t[31]||(t[31]=e=>ue.detail.imei_number=e),placeholder:e.$t("Add_product_IMEI_Serial_number")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},512),[[s.aG,ue.detail.is_imei]]),(0,i.bF)(ge,{md:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(ye,null,{default:(0,i.k6)((()=>[(0,i.bF)(we,{variant:"primary",type:"submit",disabled:ue.Submit_Processing_detail},{default:(0,i.k6)((()=>[he,(0,i.eW)(" "+(0,l.v_)(e.$t("submit")),1)])),_:1},8,["disabled"]),t[32]||((0,i.Vq)(-1),t[32]=ue.Submit_Processing_detail?((0,i.uX)(),(0,i.CE)("div",_e,me)):(0,i.Q3)("",!0),(0,i.Vq)(1),t[32])])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["title"])])),_:1},512)])}var ke=a(95353),ve=a(5947),ye=a.n(ve),fe=a(37427);const ge={metaInfo:{title:"Create Sale"},data(){return{focused:!1,timer:null,search_input:"",product_filter:[],stripe_key:"",stripe:{},cardElement:{},savedPaymentMethods:[],hasSavedPaymentMethod:!1,useSavedPaymentMethod:!1,selectedCard:null,card_id:"",is_new_credit_card:!1,submit_showing_credit_card:!1,paymentProcessing:!1,Submit_Processing_detail:!1,isLoading:!0,warehouses:[],clients:[],client:{},products:[],details:[],detail:{},sales:[],payment:{status:"pending",Reglement:"Cash",amount:"",received_amount:""},sale:{id:"",date:(new Date).toISOString().slice(0,10),statut:"completed",notes:"",client_id:"",warehouse_id:"",tax_rate:0,TaxNet:0,shipping:0,discount:0},timer:null,total:0,GrandTotal:0,units:[],product:{id:"",product_type:"",code:"",stock:"",quantity:1,discount:"",DiscountNet:"",discount_Method:"",name:"",sale_unit_id:"",fix_stock:"",fix_price:"",unitSale:"",Net_price:"",Unit_price:"",Total_price:"",subtotal:"",product_id:"",detail_id:"",taxe:"",tax_percent:"",tax_method:"",product_variant_id:"",is_imei:"",imei_number:""}}},computed:{...(0,ke.L8)(["currentUserPermissions","currentUser"]),displaySavedPaymentMethods(){return!!this.hasSavedPaymentMethod},displayFormNewCard(){return!this.useSavedPaymentMethod},isSelectedCard(){return e=>this.selectedCard===e}},methods:{async loadStripe_payment(){this.stripe=await(0,fe.c)(`${this.stripe_key}`);const e=this.stripe.elements();this.cardElement=e.create("card",{classes:{base:"bg-gray-100 rounded border border-gray-300 focus:border-indigo-500 text-base outline-none text-gray-700 p-3 leading-8 transition-colors duration-200 ease-in-out"}}),this.cardElement.mount("#card-element")},handleFocus(){this.focused=!0},handleBlur(){this.focused=!1},Selected_customer(e){this.payment.Reglement="Cash",this.savedPaymentMethods=[],this.hasSavedPaymentMethod=!1,this.useSavedPaymentMethod=!1,this.selectedCard=null,this.card_id="",this.is_new_credit_card=!1,this.submit_showing_credit_card=!1},async Selected_PaymentMethod(e){"credit card"===e?(this.savedPaymentMethods=[],this.submit_showing_credit_card=!0,this.selectedCard=null,this.card_id="",await axios.get(`/retrieve-customer?customerId=${this.sale.client_id}`).then((e=>{this.savedPaymentMethods=e.data.data,this.card_id=e.data.customer_default_source,this.hasSavedPaymentMethod=!0,this.useSavedPaymentMethod=!0,this.is_new_credit_card=!1,this.submit_showing_credit_card=!1})).catch((e=>{this.hasSavedPaymentMethod=!1,this.useSavedPaymentMethod=!1,this.is_new_credit_card=!0,this.card_id="",setTimeout((()=>{this.loadStripe_payment()}),1e3),this.submit_showing_credit_card=!1}))):(this.hasSavedPaymentMethod=!1,this.useSavedPaymentMethod=!1,this.is_new_credit_card=!1)},show_saved_credit_card(){this.hasSavedPaymentMethod=!0,this.useSavedPaymentMethod=!0,this.is_new_credit_card=!1,this.Selected_PaymentMethod("credit card")},show_new_credit_card(){this.selectedCard=null,this.card_id="",this.useSavedPaymentMethod=!1,this.hasSavedPaymentMethod=!1,this.is_new_credit_card=!0,setTimeout((()=>{this.loadStripe_payment()}),500)},selectCard(e){this.selectedCard=e,this.card_id=e.card_id},Selected_PaymentStatus(e){if("paid"==e){var t=this.GrandTotal.toFixed(2);this.payment.amount=this.formatNumber(t,2),this.payment.received_amount=this.formatNumber(t,2)}else this.payment.amount=0,this.payment.received_amount=0},Verified_paidAmount(){isNaN(this.payment.amount)?this.payment.amount=0:this.payment.amount>this.payment.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.payment.amount=0):this.payment.amount>this.GrandTotal&&(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.payment.amount=0)},Verified_Received_Amount(){isNaN(this.payment.received_amount)&&(this.payment.received_amount=0)},Submit_Sale(){this.$refs.create_sale.validate().then((e=>{e?this.payment.amount>this.payment.received_amount?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Received_amount"),this.$t("Warning")),this.payment.received_amount=0):this.payment.amount>this.GrandTotal?(this.makeToast("warning",this.$t("Paying_amount_is_greater_than_Grand_Total"),this.$t("Warning")),this.payment.amount=0):this.Create_Sale():this.makeToast("danger",this.$t("Please_fill_the_form_correctly"),this.$t("Failed"))}))},submit_Update_Detail(){this.$refs.Update_Detail.validate().then((e=>{e&&this.Update_Detail()}))},getValidationState({dirty:e,validated:t,valid:a=null}){return e||t?a:null},makeToast(e,t,a){this.$root.$bvToast.toast(t,{title:a,variant:e,solid:!0})},get_units(e){axios.get("get_units?id="+e).then((({data:e})=>this.units=e))},Modal_Updat_Detail(e){ye().start(),ye().set(.1),this.detail={},this.get_units(e.product_id),this.detail.detail_id=e.detail_id,this.detail.sale_unit_id=e.sale_unit_id,this.detail.product_type=e.product_type,this.detail.name=e.name,this.detail.Unit_price=e.Unit_price,this.detail.fix_price=e.fix_price,this.detail.fix_stock=e.fix_stock,this.detail.stock=e.stock,this.detail.tax_method=e.tax_method,this.detail.discount_Method=e.discount_Method,this.detail.discount=e.discount,this.detail.quantity=e.quantity,this.detail.tax_percent=e.tax_percent,this.detail.is_imei=e.is_imei,this.detail.imei_number=e.imei_number,setTimeout((()=>{ye().done(),this.$bvModal.show("form_Update_Detail")}),1e3)},Update_Detail(){ye().start(),ye().set(.1),this.Submit_Processing_detail=!0;for(var e=0;e<this.details.length;e++)if(this.details[e].detail_id===this.detail.detail_id){for(var t=0;t<this.units.length;t++)this.units[t].id==this.detail.sale_unit_id&&("/"==this.units[t].operator?(this.details[e].stock=this.detail.fix_stock*this.units[t].operator_value,this.details[e].unitSale=this.units[t].ShortName):(this.details[e].stock=this.detail.fix_stock/this.units[t].operator_value,this.details[e].unitSale=this.units[t].ShortName));this.details[e].stock<this.details[e].quantity?this.details[e].quantity=this.details[e].stock:this.details[e].quantity=1,this.details[e].Unit_price=this.detail.Unit_price,this.details[e].tax_percent=this.detail.tax_percent,this.details[e].tax_method=this.detail.tax_method,this.details[e].discount_Method=this.detail.discount_Method,this.details[e].discount=this.detail.discount,this.details[e].sale_unit_id=this.detail.sale_unit_id,this.details[e].imei_number=this.detail.imei_number,this.details[e].product_type=this.detail.product_type,"2"==this.details[e].discount_Method?this.details[e].DiscountNet=this.details[e].discount:this.details[e].DiscountNet=parseFloat(this.details[e].Unit_price*this.details[e].discount/100),"1"==this.details[e].tax_method?(this.details[e].Net_price=parseFloat(this.details[e].Unit_price-this.details[e].DiscountNet),this.details[e].taxe=parseFloat(this.details[e].tax_percent*(this.details[e].Unit_price-this.details[e].DiscountNet)/100)):(this.details[e].Net_price=parseFloat((this.details[e].Unit_price-this.details[e].DiscountNet)/(this.details[e].tax_percent/100+1)),this.details[e].taxe=parseFloat(this.details[e].Unit_price-this.details[e].Net_price-this.details[e].DiscountNet)),this.$forceUpdate()}this.Calcul_Total(),setTimeout((()=>{ye().done(),this.Submit_Processing_detail=!1,this.$bvModal.hide("form_Update_Detail")}),1e3)},search(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this.search_input.length<2)return this.product_filter=[];""!=this.sale.warehouse_id&&null!=this.sale.warehouse_id?this.timer=setTimeout((()=>{const e=this.products.filter((e=>e.code===this.search_input||e.barcode.includes(this.search_input)));1===e.length?this.SearchProduct(e[0]):this.product_filter=this.products.filter((e=>e.name.toLowerCase().includes(this.search_input.toLowerCase())||e.code.toLowerCase().includes(this.search_input.toLowerCase())||e.barcode.toLowerCase().includes(this.search_input.toLowerCase())))}),800):this.makeToast("warning",this.$t("SelectWarehouse"),this.$t("Warning"))},getResultValue(e){return e.code+" ("+e.name+")"},SearchProduct(e){this.product={},this.details.length>0&&this.details.some((t=>t.code===e.code))?this.makeToast("warning",this.$t("AlreadyAdd"),this.$t("Warning")):("is_service"==e.product_type?(this.product.quantity=1,this.product.code=e.code,this.product.stock="---",this.product.fix_stock="---"):(this.product.code=e.code,this.product.stock=e.qte_sale,this.product.fix_stock=e.qte,e.qte_sale<1?this.product.quantity=e.qte_sale:this.product.quantity=1),this.product.product_variant_id=e.product_variant_id,this.Get_Product_Details(e.id,e.product_variant_id)),this.search_input="",this.$refs.product_autocomplete.value="",this.product_filter=[]},Selected_Warehouse(e){this.search_input="",this.product_filter=[],this.Get_Products_By_Warehouse(e)},Get_Products_By_Warehouse(e){ye().start(),ye().set(.1),axios.get("get_Products_by_warehouse/"+e+"?stock=1&is_sale=1&product_service=1").then((e=>{this.products=e.data,ye().done()})).catch((e=>{}))},add_product(){this.details.length>0?this.Last_Detail_id():0===this.details.length&&(this.product.detail_id=1),this.details.push(this.product),this.product.is_imei&&this.Modal_Updat_Detail(this.product)},Verified_Qty(e,t){for(var a=0;a<this.details.length;a++)this.details[a].detail_id===t&&(isNaN(e.quantity)&&(this.details[a].quantity=e.stock),e.quantity>e.stock?(this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")),this.details[a].quantity=e.stock):this.details[a].quantity=e.quantity);this.$forceUpdate(),this.Calcul_Total()},increment(e,t){for(var a=0;a<this.details.length;a++)this.details[a].detail_id==t&&(e.quantity+1>e.stock?this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")):this.formatNumber(this.details[a].quantity++,2));this.$forceUpdate(),this.Calcul_Total()},decrement(e,t){for(var a=0;a<this.details.length;a++)this.details[a].detail_id==t&&e.quantity-1>0&&(e.quantity-1>e.stock?this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")):this.formatNumber(this.details[a].quantity--,2));this.$forceUpdate(),this.Calcul_Total()},formatNumber(e,t){const a=("string"===typeof e?e:e.toString()).split(".");if(t<=0)return a[0];let i=a[1]||"";if(i.length>t)return`${a[0]}.${i.substr(0,t)}`;while(i.length<t)i+="0";return`${a[0]}.${i}`},Calcul_Total(){this.total=0;for(var e=0;e<this.details.length;e++){var t=this.details[e].taxe*this.details[e].quantity;this.details[e].subtotal=parseFloat(this.details[e].quantity*this.details[e].Net_price+t),this.total=parseFloat(this.total+this.details[e].subtotal)}const a=parseFloat(this.total-this.sale.discount);this.sale.TaxNet=parseFloat(a*this.sale.tax_rate/100),this.GrandTotal=parseFloat(a+this.sale.TaxNet+this.sale.shipping);var i=this.GrandTotal.toFixed(2);this.GrandTotal=parseFloat(i),"paid"==this.payment.status&&(this.payment.amount=this.formatNumber(this.GrandTotal,2))},delete_Product_Detail(e){for(var t=0;t<this.details.length;t++)e===this.details[t].detail_id&&(this.details.splice(t,1),this.Calcul_Total())},verifiedForm(){if(this.details.length<=0)return this.makeToast("warning",this.$t("AddProductToList"),this.$t("Warning")),!1;for(var e=0,t=0;t<this.details.length;t++)if((""==this.details[t].quantity||0===this.details[t].quantity||this.details[t].quantity>this.details[t].stock)&&(e+=1,this.details[t].quantity>this.details[t].stock))return this.makeToast("warning",this.$t("LowStock"),this.$t("Warning")),!1;return!(e>0)||(this.makeToast("warning",this.$t("AddQuantity"),this.$t("Warning")),!1)},keyup_OrderTax(){isNaN(this.sale.tax_rate)?this.sale.tax_rate=0:""==this.sale.tax_rate?(this.sale.tax_rate=0,this.Calcul_Total()):this.Calcul_Total()},keyup_Discount(){isNaN(this.sale.discount)?this.sale.discount=0:""==this.sale.discount?(this.sale.discount=0,this.Calcul_Total()):this.Calcul_Total()},keyup_Shipping(){isNaN(this.sale.shipping)?this.sale.shipping=0:""==this.sale.shipping?(this.sale.shipping=0,this.Calcul_Total()):this.Calcul_Total()},async processPayment(){this.paymentProcessing=!0;const{token:e,error:t}=await this.stripe.createToken(this.cardElement);t?(this.paymentProcessing=!1,ye().done(),this.makeToast("danger",this.$t("InvalidData"),this.$t("Failed"))):axios.post("sales",{date:this.sale.date,client_id:this.sale.client_id,warehouse_id:this.sale.warehouse_id,statut:this.sale.statut,notes:this.sale.notes,tax_rate:this.sale.tax_rate?this.sale.tax_rate:0,TaxNet:this.sale.TaxNet?this.sale.TaxNet:0,discount:this.sale.discount?this.sale.discount:0,shipping:this.sale.shipping?this.sale.shipping:0,GrandTotal:this.GrandTotal,details:this.details,payment:this.payment,amount:parseFloat(this.payment.amount).toFixed(2),received_amount:parseFloat(this.payment.received_amount).toFixed(2),change:parseFloat(this.payment.received_amount-this.payment.amount).toFixed(2),token:e.id,is_new_credit_card:this.is_new_credit_card,selectedCard:this.selectedCard,card_id:this.card_id}).then((e=>{this.paymentProcessing=!1,this.makeToast("success",this.$t("Create.TitleSale"),this.$t("Success")),ye().done(),this.$router.push({name:"index_sales"})})).catch((e=>{this.paymentProcessing=!1,ye().done(),this.makeToast("danger",this.$t("InvalidData"),this.$t("Failed"))}))},Create_Sale(){this.verifiedForm()&&(ye().start(),ye().set(.1),"credit card"==this.payment.Reglement&&this.is_new_credit_card?""!=this.stripe_key?this.processPayment():(this.makeToast("danger",this.$t("credit_card_account_not_available"),this.$t("Failed")),ye().done()):(this.paymentProcessing=!0,axios.post("sales",{date:this.sale.date,client_id:this.sale.client_id,warehouse_id:this.sale.warehouse_id,statut:this.sale.statut,notes:this.sale.notes,tax_rate:this.sale.tax_rate?this.sale.tax_rate:0,TaxNet:this.sale.TaxNet?this.sale.TaxNet:0,discount:this.sale.discount?this.sale.discount:0,shipping:this.sale.shipping?this.sale.shipping:0,GrandTotal:this.GrandTotal,details:this.details,payment:this.payment,amount:parseFloat(this.payment.amount).toFixed(2),received_amount:parseFloat(this.payment.received_amount).toFixed(2),change:parseFloat(this.payment.received_amount-this.payment.amount).toFixed(2),is_new_credit_card:this.is_new_credit_card,selectedCard:this.selectedCard,card_id:this.card_id}).then((e=>{this.makeToast("success",this.$t("Create.TitleSale"),this.$t("Success")),ye().done(),this.paymentProcessing=!1,this.$router.push({name:"index_sales"})})).catch((e=>{ye().done(),this.paymentProcessing=!1,this.makeToast("danger",this.$t("InvalidData"),this.$t("Failed"))}))))},Last_Detail_id(){this.product.detail_id=0;var e=this.details.length;this.product.detail_id=this.details[e-1].detail_id+1},Get_Product_Details(e,t){axios.get("/show_product_data/"+e+"/"+t).then((e=>{this.product.discount=0,this.product.DiscountNet=0,this.product.discount_Method="2",this.product.product_id=e.data.id,this.product.product_type=e.data.product_type,this.product.name=e.data.name,this.product.Net_price=e.data.Net_price,this.product.Unit_price=e.data.Unit_price,this.product.taxe=e.data.tax_price,this.product.tax_method=e.data.tax_method,this.product.tax_percent=e.data.tax_percent,this.product.unitSale=e.data.unitSale,this.product.fix_price=e.data.fix_price,this.product.sale_unit_id=e.data.sale_unit_id,this.product.is_imei=e.data.is_imei,this.product.imei_number="",this.add_product(),this.Calcul_Total()}))},GetElements(){axios.get("sales/create").then((e=>{this.clients=e.data.clients,this.warehouses=e.data.warehouses,this.stripe_key=e.data.stripe_key,this.isLoading=!1})).catch((e=>{setTimeout((()=>{this.isLoading=!1}),500)}))}},created(){this.GetElements()}};var Fe=a(66262);const xe=(0,Fe.A)(ge,[["render",be]]),Se=xe}}]);
//# sourceMappingURL=store_sale.ec419fc2.js.map